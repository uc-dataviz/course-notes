<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Day 4 Geospatial visualizations | Data Visualization</title>
<meta name="author" content="Benjamin Soltoff">
<meta name="description" content="library(tidyverse) library(sf) library(ggmap) library(rnaturalearth) library(RColorBrewer) library(patchwork) library(tidycensus) library(viridis) library(here) # useful on MacOS to speed up...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Day 4 Geospatial visualizations | Data Visualization">
<meta property="og:type" content="book">
<meta property="og:description" content="library(tidyverse) library(sf) library(ggmap) library(rnaturalearth) library(RColorBrewer) library(patchwork) library(tidycensus) library(viridis) library(here) # useful on MacOS to speed up...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Day 4 Geospatial visualizations | Data Visualization">
<meta name="twitter:description" content="library(tidyverse) library(sf) library(ggmap) library(rnaturalearth) library(RColorBrewer) library(patchwork) library(tidycensus) library(viridis) library(here) # useful on MacOS to speed up...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.21/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="MACS 20700/40700">Data Visualization</a>:
        <small class="text-muted">MACS 20700/40700</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Syllabus</a></li>
<li><a class="" href="intro-data-viz.html"><span class="header-section-number">1</span> Introduction to data visualization</a></li>
<li><a class="" href="show-the-numbers.html"><span class="header-section-number">2</span> Showing the right numbers</a></li>
<li><a class="" href="science-polish.html"><span class="header-section-number">3</span> Making plots pretty and clean</a></li>
<li><a class="active" href="geoviz.html"><span class="header-section-number">4</span> Geospatial visualizations</a></li>
<li><a class="" href="shiny.html"><span class="header-section-number">5</span> Shiny applications</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="geoviz" class="section level1" number="4">
<h1>
<span class="header-section-number">Day 4</span> Geospatial visualizations<a class="anchor" aria-label="anchor" href="#geoviz"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap">ggmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth">rnaturalearth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>

<span class="co"># useful on MacOS to speed up rendering of geom_sf() objects</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"bitmapType"</span><span class="op">)</span>, <span class="st">"cairo"</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/capabilities.html">capabilities</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"cairo"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>bitmapType <span class="op">=</span> <span class="st">"cairo"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="learning-objectives-4" class="section level2 unnumbered">
<h2>Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-4"><i class="fas fa-link"></i></a>
</h2>
<div id="morning-3" class="section level3" number="4.0.1">
<h3>
<span class="header-section-number">4.0.1</span> Morning<a class="anchor" aria-label="anchor" href="#morning-3"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Introduce the major components of a geospatial visualization</li>
<li>Identify how to draw raster maps using <code>ggmaps</code> and <code><a href="https://rdrr.io/pkg/ggmap/man/get_map.html">get_map()</a></code>
</li>
<li>Practice generating raster maps</li>
</ul>
</div>
<div id="afternoon-3" class="section level3" number="4.0.2">
<h3>
<span class="header-section-number">4.0.2</span> Afternoon<a class="anchor" aria-label="anchor" href="#afternoon-3"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Define shapefiles and import spatial data using the <code>sf</code> package</li>
<li>Draw maps using <code>ggplot2</code> and <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>
</li>
<li>Change coordinate systems</li>
<li>Generate appropriate color palettes to visualize additional dimensions of data</li>
</ul>
</div>
</div>
<div id="assigned-readings-3" class="section level2 unnumbered">
<h2>Assigned readings<a class="anchor" aria-label="anchor" href="#assigned-readings-3"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Chapter 7, <span class="citation">Healy (<a href="references.html#ref-healy2018data" role="doc-biblioref">2018</a>)</span> - accessible via the <a href="https://socviz.co/">book’s website</a>
</li>
</ul>
</div>
<div id="introduction-to-geospatial-visualization" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Introduction to geospatial visualization<a class="anchor" aria-label="anchor" href="#introduction-to-geospatial-visualization"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Geospatial visualizations</strong> are one of the earliest forms of information visualizations. They were used historically for navigation and were essential tools before the modern technological era of humanity. Data maps were first popularized in the seventeenth century and have grown in complexity and detail since then. Consider <a href="https://www.google.com/maps">Google Maps</a>, the sheer volume of data depicted, and the analytical pathways available to its users. Of course geospatial data visualizations do not require computational skills to generate.</p>
<div id="john-snow-and-the-broad-street-water-pump" class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> John Snow and the Broad Street water pump<a class="anchor" aria-label="anchor" href="#john-snow-and-the-broad-street-water-pump"><i class="fas fa-link"></i></a>
</h3>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:snow"></span>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/819px-Snow-cholera-map-1.jpg" alt="Original map made by John Snow in 1854. Cholera cases are highlighted in black. [Source: Wikipedia.](https://commons.wikimedia.org/wiki/File:Snow-cholera-map-1.jpg)" width="80%"><p class="caption">
Figure 1.6: Original map made by John Snow in 1854. Cholera cases are highlighted in black. <a href="https://commons.wikimedia.org/wiki/File:Snow-cholera-map-1.jpg">Source: Wikipedia.</a>
</p>
</div>
<p>In the nineteenth century the theory of bacteria was not widely accepted by the medical community or the public.<a href="references.html#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> A mother washed her baby’s diaper in a well in 1854 in London, sparking an outbreak of <strong>cholera</strong>, an intestinal disease that causes vomiting, diarrhea, and eventually death. This disease had presented itself previously in London but its cause was still unknown.</p>
<p>Dr. John Snow lived in Soho, the suburb of London where the disease manifested in 1854, and wanted to understand how cholera spreads through a population (an early day epidemiologist). Snow recorded the location of individuals who contracted cholera, including their places of residence and employment. He used this information to draw a map of the region, recording the location of individuals who contracted the disease. They seemed to be clustered around the well pump along Broad Street. Snow used this map to deduce the source of the outbreak was the well, observing that almost all of the infected individuals lived near, and drank from, the well. Based on this information, the government removed the handle from the well pump so the public could not draw water from it. As a result, the cholera epidemic ended.</p>
</div>
<div id="carte-figurative-des-pertes-successives-en-hommes-de-larmée-française-dans-la-campagne-de-russie-1812-1813" class="section level3" number="4.1.2">
<h3>
<span class="header-section-number">4.1.2</span> <em>Carte figurative des pertes successives en hommes de l’Armée Française dans la campagne de Russie 1812-1813)</em><a class="anchor" aria-label="anchor" href="#carte-figurative-des-pertes-successives-en-hommes-de-larm%C3%A9e-fran%C3%A7aise-dans-la-campagne-de-russie-1812-1813"><i class="fas fa-link"></i></a>
</h3>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:minard-orig"></span>
<img src="https://upload.wikimedia.org/wikipedia/commons/2/29/Minard.png" alt="Charles Minard's 1869 chart showing the number of men in Napoleon’s 1812 Russian campaign army, their movements, as well as the temperature they encountered on the return path. [Source: Wikipedia.](https://en.wikipedia.org/wiki/File:Minard.png)" width="80%"><p class="caption">
Figure 1.7: Charles Minard’s 1869 chart showing the number of men in Napoleon’s 1812 Russian campaign army, their movements, as well as the temperature they encountered on the return path. <a href="https://en.wikipedia.org/wiki/File:Minard.png">Source: Wikipedia.</a>
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:minard-translate"></span>
<img src="https://upload.wikimedia.org/wikipedia/commons/e/e2/Minard_Update.png" alt="English translation of Minard's map. [Source: Wikipedia.](https://commons.wikimedia.org/wiki/File:Minard_Update.png)" width="80%"><p class="caption">
Figure 1.8: English translation of Minard’s map. <a href="https://commons.wikimedia.org/wiki/File:Minard_Update.png">Source: Wikipedia.</a>
</p>
</div>
<p>This illustration is identifed in Edward Tufte’s <strong>The Visual Display of Quantitative Information</strong> as one of “the best statistical drawings ever created”. It also demonstrates a very important rule of warfare: <a href="https://en.wikipedia.org/wiki/Russian_Winter">never invade Russia in the winter</a>.</p>
<p>In 1812, Napoleon ruled most of Europe. He wanted to seize control of the British islands, but could not overcome the UK defenses. He decided to impose an embargo to weaken the nation in preparation for invasion, but Russia refused to participate. Angered at this decision, Napoleon launched an invasion of Russia with over 400,000 troops in the summer of 1812. Russia was unable to defeat Napoleon in battle, but instead waged a war of attrition. The Russian army was in near constant retreat, burning or destroying anything of value along the way to deny France usable resources. While Napoleon’s army maintained the military advantage, his lack of food and the emerging European winter decimated his forces. He left France with an army of approximately 422,000 soldiers; he returned to France with just 10,000.</p>
<p>Charles Minard’s map is a stunning achievement for his era. It incorporates data across six dimensions to tell the story of Napoleon’s failure. The graph depicts:</p>
<ul>
<li>Size of the army</li>
<li>Location in two physical dimensions (latitude and longitude)</li>
<li>Direction of the army’s movement</li>
<li>Temperature on dates during Napoleon’s retreat</li>
</ul>
<p>What makes this such an effective visualization?<a href="references.html#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<ul>
<li>Forces visual comparisons (colored bands for advancing and retreating)</li>
<li>Shows causality (temperature chart)</li>
<li>Captures multivariate complexity</li>
<li>Integrates text and graphic into a coherent whole (perhaps the first infographic, and done well!)</li>
<li>Illustrates high quality content (based on reliable data)</li>
<li>Places comparisons adjacent to each other (all on the same page, no jumping back and forth between pages)</li>
<li>Mimimalistic in nature (avoids what we will later term “chart junk”)</li>
</ul>
</div>
<div id="designing-modern-maps" class="section level3" number="4.1.3">
<h3>
<span class="header-section-number">4.1.3</span> Designing modern maps<a class="anchor" aria-label="anchor" href="#designing-modern-maps"><i class="fas fa-link"></i></a>
</h3>
<p>Geometric visualizations are used to depict spatial features, and with the incorporation of data reveal additional attributes and information. The main features of a map are defined by its <strong>scale</strong> (the proportion between distances and sizes on the map), its <strong>projection</strong> (how the three-dimensional Earth is represented on a two-dimensional surface), and its <strong>symbols</strong> (how data is depicted and visualized on the map).</p>
<div id="scale-1" class="section level4" number="4.1.3.1">
<h4>
<span class="header-section-number">4.1.3.1</span> Scale<a class="anchor" aria-label="anchor" href="#scale-1"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Scale</strong> defines the proportion between distances and sizes on a map and their actual distances and sizes on Earth. Depending on the total geographic area for which you have data to visualize, you could create a <strong>small-scale map</strong> or a <strong>large-scale map</strong>. So for instance, a map of the United States would be considered large-scale:</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Whereas a map of Hyde Park would be small-scale:</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The smaller the scale, the easier it is to include additional details in the map.</p>
</div>
<div id="projection" class="section level4" number="4.1.3.2">
<h4>
<span class="header-section-number">4.1.3.2</span> Projection<a class="anchor" aria-label="anchor" href="#projection"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Projection</strong> is the process of taking a globe (i.e. a three-dimensional object)<a href="references.html#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> and visualizing it on a two-dimensional picture. There is no 100% perfect method for doing this, as any projection method will have to distort some features of the map to achieve a two-dimensional representation. There are five properties to consider when defining a projection method:</p>
<ol style="list-style-type: decimal">
<li>Shape</li>
<li>Area</li>
<li>Angles</li>
<li>Distance</li>
<li>Direction</li>
</ol>
<p>Projection methods typically maximize the accuracy of one or two of these properties, but no more. For instance, <strong>conformal projections</strong> such as the <strong>mercator</strong> projection preserves shape and local angles and is very useful for sea navigation, but distorts the area of landmasses.</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/mercator-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The farther away from the equator one travels, the more distorted the size of the region.</p>
<p>Another family of projections called <strong>equal-area projections</strong> preserves area ratios, so that the relative size of areas on a map are proportional to their areas on the Earth.</p>
<p><img src="04-making-maps_files/figure-html/equal-area-1.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/equal-area-2.png" width="80%" style="display: block; margin: auto;"></p>
<p>The downside is that equal-area projections tend to distory shapes heavily, so shapes of areas can become distorted. No method can be both conformal and equal-area simultaneously, but some methods such as the <strong>Mollweide</strong> projection achieve a trade-off between these sets of characteristics.</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/mollweide-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="symbols" class="section level4" number="4.1.3.3">
<h4>
<span class="header-section-number">4.1.3.3</span> Symbols<a class="anchor" aria-label="anchor" href="#symbols"><i class="fas fa-link"></i></a>
</h4>
<p>Different types of symbols are used to denote different types of information on a spatial visualization. For instance, consider the following map of Hyde Park:</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;"></div>
<ul>
<li>Line are used to indicate roadways</li>
<li>Fill is used to indicate type of land (grassland, water, urban, etc.)</li>
<li>Symbols/shapes are used to locate buildings</li>
<li>Text labels are used to indicate geographic locations</li>
</ul>
<p>Data maps do not just encode geographic features on the visualization. They also plot quantitative and qualitative data on the mapping surface itself. Minard’s drawing was not just of geographic coordinates and features - it also visualizes quantitative data such as troop deaths and temperature. Different symbols are used depending on the type of data you seek to visualize.</p>
</div>
</div>
</div>
<div id="drawing-raster-maps-with-ggmap" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Drawing raster maps with <code>ggmap</code><a class="anchor" aria-label="anchor" href="#drawing-raster-maps-with-ggmap"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/dkahle/ggmap"><code>ggmap</code></a> is a package for R that retrieves raster map tiles from online mapping services like <a href="https://www.google.com/maps">Google Maps</a> and plots them using the <code>ggplot2</code> framework. The map tiles are <strong>raster</strong> because they are static image files generated previously by the mapping service. You do not need any data files containing information on things like scale, projection, boundaries, etc. because that information is already created by the map tile. This severely limits your ability to redraw or change the appearance of the geographic map, however the tradeoff means you can immediately focus on incorporating additional data into the map.</p>

<div class="rmdalert">
<p>Google has <a href="https://developers.google.com/maps/documentation/geocoding/usage-and-billing">changed its API requirements</a>, and <strong>ggmap</strong> users are now required to provide an API key <em>and</em> enable billing. I would not recommend trying to use Google Maps to obtain map images. The code below would work for you, but Google now charges you each time you obtain a map image. Stick to the other providers such as Stamen Maps.</p>
</div>
<div id="obtain-map-images" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Obtain map images<a class="anchor" aria-label="anchor" href="#obtain-map-images"><i class="fas fa-link"></i></a>
</h3>
<p><code>ggmap</code> supports open-source map providers such as <a href="https://www.openstreetmap.org/">OpenStreetMap</a> and <a href="http://maps.stamen.com/#terrain/12/37.7706/-122.3782">Stamen Maps</a>, as well as the proprietary Google Maps. Obtaining map tiles requires use of the <code><a href="https://rdrr.io/pkg/ggmap/man/get_map.html">get_map()</a></code> function. There are two formats for specifying the mapping region you wish to obtain:</p>
<ol style="list-style-type: decimal">
<li>Bounding box</li>
<li>Center/zoom</li>
</ol>
</div>
<div id="specifying-map-regions" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Specifying map regions<a class="anchor" aria-label="anchor" href="#specifying-map-regions"><i class="fas fa-link"></i></a>
</h3>
<div id="bounding-box" class="section level4" number="4.2.2.1">
<h4>
<span class="header-section-number">4.2.2.1</span> Bounding box<a class="anchor" aria-label="anchor" href="#bounding-box"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Bounding box</strong> requires the user to specify the four corners of the box defining the map region. For instance, to obtain a map of Chicago using Stamen Maps:</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># store bounding box coordinates</span>
<span class="va">chi_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="op">-</span><span class="fl">87.936287</span>,
            bottom <span class="op">=</span> <span class="fl">41.679835</span>,
            right <span class="op">=</span> <span class="op">-</span><span class="fl">87.447052</span>,
            top <span class="op">=</span> <span class="fl">42.000835</span><span class="op">)</span>

<span class="va">chicago_stamen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">chi_bb</span>,
                                zoom <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>
<span class="va">chicago_stamen</span>
<span class="co">## 627x712 terrain map image from Stamen Maps. </span>
<span class="co">## See ?ggmap to plot it.</span></code></pre></div>
<p>To view the map, use <code><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap()</a></code>:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago_stamen</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-chicago-stamen-plot-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The <code>zoom</code> argument in <code><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap()</a></code> controls the level of detail in the map. The larger the number, the greater the detail.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">chi_bb</span>,
              zoom <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-chicago-stamen-zoom-in-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The smaller the number, the lesser the detail.</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">chi_bb</span>,
              zoom <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-chicago-stamen-zoom-out-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Trial and error will help you decide on the appropriate level of detail depending on what data you need to visualize on the map.</p>

<div class="rmdnote">
<p>Use <a href="http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000">bboxfinder.com</a> to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain.</p>
</div>
</div>
<div id="centerzoom" class="section level4" number="4.2.2.2">
<h4>
<span class="header-section-number">4.2.2.2</span> Center/zoom<a class="anchor" aria-label="anchor" href="#centerzoom"><i class="fas fa-link"></i></a>
</h4>
<p>While Stamen Maps and OpenStreetMap require the bounding box format for obtaining map tiles and allow you to increase or decrease the level of detail within a single bounding box, Google Maps requires specifying the <strong>center</strong> coordinate of the map (a single longitude/latitude location) and the level of <strong>zoom</strong> or detail. <code>zoom</code> is an integer value from <code>3</code> (continent) to <code>21</code> (building). This means the level of detail is hardcoded to the size of the mapping region. The default <code>zoom</code> level is <code>10</code>.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># store center coordinate</span>
<span class="va">chi_center</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">87.65</span>, lat <span class="op">=</span> <span class="fl">41.855</span><span class="op">)</span>

<span class="va">chicago_google</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_googlemap.html">get_googlemap</a></span><span class="op">(</span>center <span class="op">=</span> <span class="va">chi_center</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago_google</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_googlemap.html">get_googlemap</a></span><span class="op">(</span>center <span class="op">=</span> <span class="va">chi_center</span>,
              zoom <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_googlemap.html">get_googlemap</a></span><span class="op">(</span>center <span class="op">=</span> <span class="va">chi_center</span>,
              zoom <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>

<div class="rmdnote">
<p>Use <a href="https://www.findlatitudeandlongitude.com/">Find Latitude and Longitude</a> to get the exact GPS coordinates of the center location.</p>
</div>
</div>
</div>
<div id="types-of-map-tiles" class="section level3" number="4.2.3">
<h3>
<span class="header-section-number">4.2.3</span> Types of map tiles<a class="anchor" aria-label="anchor" href="#types-of-map-tiles"><i class="fas fa-link"></i></a>
</h3>
<p>Each map tile provider offers a range of different types of maps depending on the background you want for the map. Stamen Maps offers several different types:</p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Google Maps is a bit more limited, but still offers a few major types:</p>
<p>See the documentation for the <code>get_*map()</code> function for the exact code necessary to get each type of map.</p>

<div class="rmdnote">
<p><code><a href="https://rdrr.io/pkg/ggmap/man/get_map.html">get_map()</a></code> is a wrapper that automatically queries Google Maps, OpenStreetMap, or Stamen Maps depending on the function arguments and inputs. While useful, it also combines all the different arguments of <code><a href="https://rdrr.io/pkg/ggmap/man/get_googlemap.html">get_googlemap()</a></code>, <code><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap()</a></code>, and <code>getopenstreetmap()</code> and can become a bit jumbled. Use at your own risk.</p>
</div>
</div>
<div id="import-crime-data" class="section level3" number="4.2.4">
<h3>
<span class="header-section-number">4.2.4</span> Import crime data<a class="anchor" aria-label="anchor" href="#import-crime-data"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we can obtain map tiles and draw them using <code><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap()</a></code>, let’s explore how to add data to the map. The city of Chicago has <a href="https://data.cityofchicago.org/">an excellent data portal</a> publishing a large volume of public records. Here we’ll look at <a href="https://data.cityofchicago.org/Public-Safety/Crimes-2017/d62x-nvdr">crime data from 2017</a>.<a href="references.html#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> I previously downloaded a <code>.csv</code> file containing all the records, which I import using <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>:</p>

<div class="rmdnote">
<p>If you are copying-and-pasting code from this demonstration, change this line of code to <code>crimes &lt;- read_csv("https://cfss.uchicago.edu/data/Crimes_-_2017.csv")</code> to download the file from the course website.</p>
</div>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"Crimes_-_2017.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">crimes</span><span class="op">)</span>
<span class="co">## Rows: 267,345</span>
<span class="co">## Columns: 22</span>
<span class="co">## $ ID                     &lt;dbl&gt; 11094370, 11118031, 11134189, 11156462, 1116487…</span>
<span class="co">## $ `Case Number`          &lt;chr&gt; "JA440032", "JA470589", "JA491697", "JA521389",…</span>
<span class="co">## $ Date                   &lt;chr&gt; "09/21/2017 12:15:00 AM", "10/12/2017 07:14:00 …</span>
<span class="co">## $ Block                  &lt;chr&gt; "072XX N CALIFORNIA AVE", "055XX W GRAND AVE", …</span>
<span class="co">## $ IUCR                   &lt;chr&gt; "1122", "1345", "4651", "1110", "0265", "143A",…</span>
<span class="co">## $ `Primary Type`         &lt;chr&gt; "DECEPTIVE PRACTICE", "CRIMINAL DAMAGE", "OTHER…</span>
<span class="co">## $ Description            &lt;chr&gt; "COUNTERFEIT CHECK", "TO CITY OF CHICAGO PROPER…</span>
<span class="co">## $ `Location Description` &lt;chr&gt; "CURRENCY EXCHANGE", "JAIL / LOCK-UP FACILITY",…</span>
<span class="co">## $ Arrest                 &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,…</span>
<span class="co">## $ Domestic               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…</span>
<span class="co">## $ Beat                   &lt;chr&gt; "2411", "2515", "0922", "2514", "1221", "0232",…</span>
<span class="co">## $ District               &lt;chr&gt; "024", "025", "009", "025", "012", "002", "005"…</span>
<span class="co">## $ Ward                   &lt;dbl&gt; 50, 29, 12, 30, 32, 20, 9, 12, 12, 27, 32, 17, …</span>
<span class="co">## $ `Community Area`       &lt;dbl&gt; 2, 19, 58, 19, 24, 40, 49, 30, 30, 23, 24, 44, …</span>
<span class="co">## $ `FBI Code`             &lt;chr&gt; "10", "14", "26", "11", "02", "15", "03", "06",…</span>
<span class="co">## $ `X Coordinate`         &lt;dbl&gt; 1156443, 1138788, 1159425, 1138653, 1161264, 11…</span>
<span class="co">## $ `Y Coordinate`         &lt;dbl&gt; 1947707, 1913480, 1875711, 1920720, 1905292, 18…</span>
<span class="co">## $ Year                   &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017,…</span>
<span class="co">## $ `Updated On`           &lt;chr&gt; "03/01/2018 03:52:35 PM", "03/01/2018 03:52:35 …</span>
<span class="co">## $ Latitude               &lt;dbl&gt; 42.0, 41.9, 41.8, 41.9, 41.9, 41.8, 41.7, 41.8,…</span>
<span class="co">## $ Longitude              &lt;dbl&gt; -87.7, -87.8, -87.7, -87.8, -87.7, -87.6, -87.6…</span>
<span class="co">## $ Location               &lt;chr&gt; "(42.012293397, -87.699714109)", "(41.918711651…</span></code></pre></div>
<p>Each row of the data frame is a single reported incident of crime. Geographic location is encoded in several ways, though most importantly for us the exact longitude and latitude of the incident is encoded in the <code>Longitude</code> and <code>Latitude</code> columns respectively.</p>
</div>
<div id="plot-high-level-map-of-crime" class="section level3" number="4.2.5">
<h3>
<span class="header-section-number">4.2.5</span> Plot high-level map of crime<a class="anchor" aria-label="anchor" href="#plot-high-level-map-of-crime"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s start with a simple high-level overview of reported crime in Chicago. First we need a map for the entire city.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chicago</span> <span class="op">&lt;-</span> <span class="va">chicago_stamen</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/import-chicago-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="using-geom_point" class="section level3" number="4.2.6">
<h3>
<span class="header-section-number">4.2.6</span> Using <code>geom_point()</code><a class="anchor" aria-label="anchor" href="#using-geom_point"><i class="fas fa-link"></i></a>
</h3>
<p>Since each row is a single reported incident of crime, we could use <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> to map the location of every crime in the dataset. Because <code><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap()</a></code> uses the map tiles (here, defined by <code>chicago</code>) as the basic input, we specify <code>data</code> and <code>mapping</code> inside of <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, rather than inside <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span>,
             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                           y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>What went wrong? All we get is a sea of black.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crimes</span><span class="op">)</span>
<span class="co">## [1] 267345</span></code></pre></div>
<p>Oh yeah. There were 267345 reported incidents of crime in the city. Each incident is represented by a dot on the map. How can we make this map more usable? One option is to decrease the size and increase the transparancy of each data point so dense clusters of crime become apparent:</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                 y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">.25</span>,
             alpha <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Better, but still not quite as useful as it could be.</p>
</div>
<div id="using-stat_density_2d" class="section level3" number="4.2.7">
<h3>
<span class="header-section-number">4.2.7</span> Using <code>stat_density_2d()</code><a class="anchor" aria-label="anchor" href="#using-stat_density_2d"><i class="fas fa-link"></i></a>
</h3>
<p>Instead of relying on <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> and plotting the raw data, a better approach is to create a <strong>heatmap</strong>. More precisely, this will be a two-dimensional kernel density estimation (KDE). In this context, KDE will take all the raw data (i.e. reported incidents of crime) and convert it into a smoothed plot showing geographic concentrations of crime. The core function in <code>ggplot2</code> to generate this kind of plot is <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d()</a></code>:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                      y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>By default, <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d()</a></code> draws a <a href="https://en.wikipedia.org/wiki/Contour_line"><strong>contour plot</strong></a> with lines of constant value. That is, each line represents approximately the same frequency of crime all along that specific line. Contour plots are frequently used in maps (known as <strong>topographic maps</strong>) to denote elevation.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:contour-plot"></span>
<img src="https://prd-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/thumbnails/image/CadillacMountainscreenshot.jpg" alt="The Cadillac Mountains. Source: [US Geological Survey](https://www.usgs.gov/media/images/cadillacmountainss)." width="80%"><p class="caption">
Figure 4.1: The Cadillac Mountains. Source: <a href="https://www.usgs.gov/media/images/cadillacmountainss">US Geological Survey</a>.
</p>
</div>
<p>Rather than drawing lines, instead we can fill in the graph so that we use the <code>fill</code> aesthetic to draw bands of crime density. To do that, we use the related function <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d()</a></code>:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                      y <span class="op">=</span> <span class="va">Latitude</span>,
                      fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,
                  geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Note the two new arguments:</p>
<ul>
<li>
<code>geom = "polygon"</code> - change the <a href="/notes/grammar-of-graphics/#geometric-objects">geometric object</a> to be drawn from a <code>density_2d</code> geom to a <code>polygon</code> geom</li>
<li>
<code>fill = stat(level)</code> - the value for the <code>fill</code> aesthetic is the <code>level</code> calculated within <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d()</a></code>, which we access using the <code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat()</a></code> notation.</li>
</ul>
<p>This is an improvement, but we can adjust some additional settings to make the graph visually more useful. Specifically,</p>
<ul>
<li>Increase the number of <code>bins</code>, or unique bands of color allowed on the graph</li>
<li>Make the heatmap semi-transparent using <code>alpha</code> so we can still view the underlying map</li>
<li>Change the color palette to better distinguish between high and low crime areas. Here I use <code><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal()</a></code> from the <code>RColorBrewer</code> package to create a custom color palette using reds and yellows.</li>
</ul>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                      y <span class="op">=</span> <span class="va">Latitude</span>,
                      fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,
                  alpha <span class="op">=</span> <span class="fl">.2</span>,
                  bins <span class="op">=</span> <span class="fl">25</span>,
                  geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>, <span class="st">"YlOrRd"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>From this map, a couple trends are noticeable:</p>
<ul>
<li>The downtown region has the highest crime incidence rate. Not surprising given its population density during the workday.</li>
<li>There are clusters of crime on the south and west sides. Also not surprising if you know anything about the city of Chicago.</li>
</ul>
</div>
<div id="looking-for-variation" class="section level3" number="4.2.8">
<h3>
<span class="header-section-number">4.2.8</span> Looking for variation<a class="anchor" aria-label="anchor" href="#looking-for-variation"><i class="fas fa-link"></i></a>
</h3>
<p>Because <code>ggmap</code> is built on <code>ggplot2</code>, we can use the core features of <code>ggplot2</code> to modify the graph. One major feature is faceting. Let’s focus our analysis on four types of crimes with similar frequency of reported incidents<a href="references.html#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> and facet by type of crime:</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Primary Type`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BURGLARY"</span>, <span class="st">"MOTOR VEHICLE THEFT"</span>,
                                                 <span class="st">"NARCOTICS"</span>, <span class="st">"ROBBERY"</span><span class="op">)</span><span class="op">)</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                      y <span class="op">=</span> <span class="va">Latitude</span>,
                      fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,
                  alpha <span class="op">=</span> <span class="fl">.4</span>,
                  bins <span class="op">=</span> <span class="fl">10</span>,
                  geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>, <span class="st">"YlOrRd"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">`Primary Type`</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-crime-wday-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>There is a large difference in the geographic density of narcotics crimes relative to the other catgories. While burglaries, motor vehicle thefts, and robberies are reasonably prevalent all across the city, the vast majority of narcotics crimes occur in the west and south sides of the city.</p>
</div>
<div id="locations-of-murders" class="section level3" number="4.2.9">
<h3>
<span class="header-section-number">4.2.9</span> Locations of murders<a class="anchor" aria-label="anchor" href="#locations-of-murders"><i class="fas fa-link"></i></a>
</h3>
<p>While <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> was not appropriate for graphing a large number of observations in a dense geographic location, it does work rather well for less dense areas. Now let’s limit our analysis strictly to reported incidents of homicide in 2017.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">homicides</span> <span class="op">&lt;-</span> <span class="va">crimes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Primary Type`</span> <span class="op">==</span> <span class="st">"HOMICIDE"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 671 × 22</span>
<span class="co">##          ID `Case Number` Date            Block IUCR  `Primary Type` Description</span>
<span class="co">##       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;      </span>
<span class="co">##  1    23128 JA149608      02/11/2017 07:… 001X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  2    23851 JA530946      11/30/2017 11:… 088X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  3    23355 JA302423      06/11/2017 06:… 047X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  4    23379 JA312425      06/18/2017 04:… 006X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  5    23673 JA490016      10/28/2017 10:… 048X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  6    23224 JA210752      04/03/2017 12:… 013X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  7    23627 JA461918      10/07/2017 11:… 018X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  8    23628 JA461918      10/07/2017 11:… 018X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  9 10836558 JA138326      02/01/2017 06:… 013X… 0142  HOMICIDE       RECKLESS H…</span>
<span class="co">## 10    23477 JA364517      07/26/2017 05:… 047X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">## # … with 661 more rows, and 15 more variables: `Location Description` &lt;chr&gt;,</span>
<span class="co">## #   Arrest &lt;lgl&gt;, Domestic &lt;lgl&gt;, Beat &lt;chr&gt;, District &lt;chr&gt;, Ward &lt;dbl&gt;,</span>
<span class="co">## #   `Community Area` &lt;dbl&gt;, `FBI Code` &lt;chr&gt;, `X Coordinate` &lt;dbl&gt;,</span>
<span class="co">## #   `Y Coordinate` &lt;dbl&gt;, Year &lt;dbl&gt;, `Updated On` &lt;chr&gt;, Latitude &lt;dbl&gt;,</span>
<span class="co">## #   Longitude &lt;dbl&gt;, Location &lt;chr&gt;</span></code></pre></div>
<p>We can draw a map of the city with all homicides indicated on the map using <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>:</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">homicides</span>,
             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>,
                           y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/homicide-city-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Compared to our previous overviews, few if any homicides are reported downtown. We can also narrow down the geographic location to map specific neighborhoods in Chicago. First we obtain map tiles for those specific regions. Here we’ll examine North Lawndale and Kenwood.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># North Lawndale is the highest homicides in 2017</span>
<span class="co"># Compare to Kenwood</span>
<span class="va">north_lawndale_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  left <span class="op">=</span> <span class="op">-</span><span class="fl">87.749047</span>,
  bottom <span class="op">=</span> <span class="fl">41.840185</span>,
  right <span class="op">=</span> <span class="op">-</span><span class="fl">87.687893</span>,
  top <span class="op">=</span> <span class="fl">41.879850</span>
<span class="op">)</span>
<span class="va">north_lawndale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">north_lawndale_bb</span>,
                                zoom <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>

<span class="va">kenwood_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  left <span class="op">=</span> <span class="op">-</span><span class="fl">87.613113</span>,
  bottom <span class="op">=</span> <span class="fl">41.799215</span>,
  right <span class="op">=</span> <span class="op">-</span><span class="fl">87.582536</span>,
  top <span class="op">=</span> <span class="fl">41.819064</span>
<span class="op">)</span>
<span class="va">kenwood</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">kenwood_bb</span>,
                                zoom <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">north_lawndale</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/get-high-low-murder-maps-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">kenwood</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/get-high-low-murder-maps-2.png" width="80%" style="display: block; margin: auto;"></div>
<p>To plot homicides specifically in these neighborhoods, change <code>ggmap(chicago)</code> to the appropriate map tile:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">north_lawndale</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">homicides</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>, y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-murder-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">kenwood</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">homicides</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>, y <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-murder-2.png" width="80%" style="display: block; margin: auto;"></div>
<p>North Lawndale had the most reported homicides in 2017, whereas Kenwood had only a handful. And even though <code>homicides</code> contained data for homicides across the entire city, <code><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap()</a></code> automatically cropped the graph to keep just the homicides that occurred within the bounding box.</p>
<p>All the other aesthetic customizations of <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> work with <code>ggmap</code>. So we could expand these neighborhood maps to include all violent crime categories<a href="references.html#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> and distinguish each type by <code>color</code>:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">violent</span> <span class="op">&lt;-</span> <span class="va">crimes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Primary Type`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HOMICIDE"</span>,
                               <span class="st">"CRIM SEXUAL ASSAULT"</span>,
                               <span class="st">"ROBBERY"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 14,146 × 22</span>
<span class="co">##          ID `Case Number` Date            Block IUCR  `Primary Type` Description</span>
<span class="co">##       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;      </span>
<span class="co">##  1 11164874 JA531910      12/01/2017 06:… 022X… 0265  CRIM SEXUAL A… AGGRAVATED…</span>
<span class="co">##  2 10995008 JA322389      06/25/2017 07:… 003X… 031A  ROBBERY        ARMED: HAN…</span>
<span class="co">##  3 11175304 JA545986      12/11/2017 07:… 007X… 031A  ROBBERY        ARMED: HAN…</span>
<span class="co">##  4 11175934 JA546734      12/12/2017 06:… 007X… 031A  ROBBERY        ARMED: HAN…</span>
<span class="co">##  5 11227287 JB147188      10/08/2017 03:… 092X… 0281  CRIM SEXUAL A… NON-AGGRAV…</span>
<span class="co">##  6 11227634 JB147599      08/26/2017 10:… 001X… 0281  CRIM SEXUAL A… NON-AGGRAV…</span>
<span class="co">##  7    23128 JA149608      02/11/2017 07:… 001X… 0110  HOMICIDE       FIRST DEGR…</span>
<span class="co">##  8 11043709 JA378592      08/05/2017 03:… 038X… 0313  ROBBERY        ARMED: OTH…</span>
<span class="co">##  9 11170225 JA538651      12/06/2017 09:… 092X… 031A  ROBBERY        ARMED: HAN…</span>
<span class="co">## 10 11228964 JB149656      12/24/2017 02:… 005X… 0330  ROBBERY        AGGRAVATED </span>
<span class="co">## # … with 14,136 more rows, and 15 more variables: `Location Description` &lt;chr&gt;,</span>
<span class="co">## #   Arrest &lt;lgl&gt;, Domestic &lt;lgl&gt;, Beat &lt;chr&gt;, District &lt;chr&gt;, Ward &lt;dbl&gt;,</span>
<span class="co">## #   `Community Area` &lt;dbl&gt;, `FBI Code` &lt;chr&gt;, `X Coordinate` &lt;dbl&gt;,</span>
<span class="co">## #   `Y Coordinate` &lt;dbl&gt;, Year &lt;dbl&gt;, `Updated On` &lt;chr&gt;, Latitude &lt;dbl&gt;,</span>
<span class="co">## #   Longitude &lt;dbl&gt;, Location &lt;chr&gt;</span></code></pre></div>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">north_lawndale</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">violent</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>, y <span class="op">=</span> <span class="va">Latitude</span>,
                 color <span class="op">=</span> <span class="va">`Primary Type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-violent-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">kenwood</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">violent</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>, y <span class="op">=</span> <span class="va">Latitude</span>,
                 color <span class="op">=</span> <span class="va">`Primary Type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/plot-violent-2.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="exercise-chicago-311-data" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Exercise: Chicago 311 data<a class="anchor" aria-label="anchor" href="#exercise-chicago-311-data"><i class="fas fa-link"></i></a>
</h2>
<p>The city of Chicago has <a href="https://data.cityofchicago.org/">an excellent data portal</a> publishing a large volume of public records. Here we’ll look at a subset of the <a href="https://data.cityofchicago.org/Service-Requests/311-Service-Requests/v6vf-nfxy">311 service requests</a>. I used <code>RSocrata</code> and the data portal’s <a href="/notes/application-program-interface/">API</a> to retrieve a portion of the data set.</p>

<div class="rmdnote">
<p>Download the necessary data files for the following coding exercises using <code>usethis::use_course("css-data-mining-viz/geoviz")</code>.</p>
</div>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chi_311</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/chi-311.csv"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">chi_311</span><span class="op">)</span>
<span class="co">## Rows: 167,552</span>
<span class="co">## Columns: 8</span>
<span class="co">## $ sr_number      &lt;chr&gt; "SR19-01209373", "SR19-01129184", "SR19-01130159", "SR1…</span>
<span class="co">## $ sr_type        &lt;chr&gt; "Dead Animal Pick-Up Request", "Dead Animal Pick-Up Req…</span>
<span class="co">## $ sr_short_code  &lt;chr&gt; "SGQ", "SGQ", "SGQ", "SGQ", "SGQ", "SGQ", "SGQ", "SGQ",…</span>
<span class="co">## $ created_date   &lt;dttm&gt; 2019-03-23 17:13:05, 2019-03-09 01:37:26, 2019-03-09 1…</span>
<span class="co">## $ community_area &lt;dbl&gt; 58, 40, 40, 67, 59, 59, 2, 59, 59, 64, 59, 25, 25, 59, …</span>
<span class="co">## $ ward           &lt;dbl&gt; 12, 20, 20, 17, 12, 12, 40, 12, 12, 13, 12, 29, 28, 12,…</span>
<span class="co">## $ latitude       &lt;dbl&gt; 41.8, 41.8, 41.8, 41.8, 41.8, 41.8, 42.0, 41.8, 41.8, 4…</span>
<span class="co">## $ longitude      &lt;dbl&gt; -87.7, -87.6, -87.6, -87.7, -87.7, -87.7, -87.7, -87.7,…</span></code></pre></div>
<div id="visualize-the-311-data" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Visualize the 311 data<a class="anchor" aria-label="anchor" href="#visualize-the-311-data"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Obtain map tiles using <code>ggmap</code> for the city of Chicago.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># store bounding box coordinates</span>
<span class="va">chi_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="op">-</span><span class="fl">87.936287</span>,
            bottom <span class="op">=</span> <span class="fl">41.679835</span>,
            right <span class="op">=</span> <span class="op">-</span><span class="fl">87.447052</span>,
            top <span class="op">=</span> <span class="fl">42.000835</span><span class="op">)</span>

<span class="co"># retrieve bounding box</span>
<span class="va">chicago</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">chi_bb</span>,
                         zoom <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>

<span class="co"># plot the raster map</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-chicago-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
<li>
<p>Generate a scatterplot of complaints about potholes in streets.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># initialize map</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add layer with scatterplot</span>
  <span class="co"># use alpha to show density of points</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">chi_311</span>, <span class="va">sr_type</span> <span class="op">==</span> <span class="st">"Pothole in Street Complaint"</span><span class="op">)</span>,
             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>,
                           y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">.25</span>,
             alpha <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/potholes-point-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
<li>
<p>Generate a heatmap of complaints about potholes in streets. Do you see any unusual patterns or clusterings?</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># initialize the map</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">chicago</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add the heatmap</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">chi_311</span>, <span class="va">sr_type</span> <span class="op">==</span> <span class="st">"Pothole in Street Complaint"</span><span class="op">)</span>,
                  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>,
                                y <span class="op">=</span> <span class="va">latitude</span>,
                                fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,
                  alpha <span class="op">=</span> <span class="fl">.1</span>,
                  bins <span class="op">=</span> <span class="fl">50</span>,
                  geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># customize the color gradient</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"YlOrRd"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/potholes-heatmap-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Seems to be clustered on the north side. Also looks to occur along major arterial routes for commuting traffic. Makes sense because they receive the most wear and tear.</p>

</details>
</li>
<li>
<p>Obtain map tiles for Hyde Park.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># store bounding box coordinates</span>
<span class="va">hp_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="op">-</span><span class="fl">87.608221</span>,
           bottom <span class="op">=</span> <span class="fl">41.783249</span>,
           right <span class="op">=</span> <span class="op">-</span><span class="fl">87.577643</span>,
           top <span class="op">=</span> <span class="fl">41.803038</span><span class="op">)</span>

<span class="co"># retrieve bounding box</span>
<span class="va">hyde_park</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">hp_bb</span>,
                           zoom <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>

<span class="co"># plot the raster map</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">hyde_park</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/bb-hyde-park-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
<li>
<p>Generate a scatterplot of requests to pick up dead animals in Hyde Park.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># initialize the map</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">hyde_park</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># add a scatterplot layer</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">chi_311</span>, <span class="va">sr_type</span> <span class="op">==</span> <span class="st">"Dead Animal Pick-Up Request"</span><span class="op">)</span>,
             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>,
                           y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/dead-animals-point-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
</ol>
</div>
</div>
<div id="importing-spatial-data-files-using-sf" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Importing spatial data files using <code>sf</code><a class="anchor" aria-label="anchor" href="#importing-spatial-data-files-using-sf"><i class="fas fa-link"></i></a>
</h2>
<p>Rather than storing spatial data as raster image files which are not easily modifiable, we can instead store spatial data as <strong>vector</strong> files. Vector files store the underlying geographical features (e.g. points, lines, polygons) as numerical data which software such as R can import and use to draw a map.</p>
<p>There are <a href="https://en.wikipedia.org/wiki/GIS_file_formats#Popular_GIS_file_formats">many popular file formats for storing spatial data.</a> Here we will look at two common file types, <strong>shapefiles</strong> and <strong>GeoJSON</strong>.</p>
</div>
<div id="file-formats" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> File formats<a class="anchor" aria-label="anchor" href="#file-formats"><i class="fas fa-link"></i></a>
</h2>
<div id="shapefile" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Shapefile<a class="anchor" aria-label="anchor" href="#shapefile"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Shapefiles</strong> are a commonly supported file type for spatial data dating back to the early 1990s. Proprietary software for geographic information systems (GIS) such as <a href="https://www.esri.com/en-us/arcgis/about-arcgis/overview">ArcGIS</a> pioneered this format and helps maintain its continued usage. A shapefile encodes points, lines, and polygons in geographic space, and is actually a set of files. Shapefiles appear with a <code>.shp</code> extension, sometimes with accompanying files ending in <code>.dbf</code> and <code>.prj</code>.</p>
<ul>
<li>
<code>.shp</code> stores the geographic coordinates of the geographic features (e.g. country, state, county)</li>
<li>
<code>.dbf</code> stores data associated with the geographic features (e.g. unemployment rate, crime rates, percentage of votes cast for Donald Trump)</li>
<li>
<code>.prj</code> stores information about the projection of the coordinates in the shapefile</li>
</ul>
<p>When importing a shapefile, you need to ensure all the files are in the same folder. For example, here is the structure of the <a href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php">Census Bureau’s 2013 state boundaries shapefile</a>:</p>
<pre><code>## -- cb_2013_us_county_20m.dbf
## -- cb_2013_us_county_20m.prj
## -- cb_2013_us_county_20m.shp
## -- cb_2013_us_county_20m.shp.iso.xml
## -- cb_2013_us_county_20m.shp.xml
## -- cb_2013_us_county_20m.shx
## -- county_20m.ea.iso.xml</code></pre>
<p><strong>This is the complete shapefile.</strong> If any of these files are missing, you will get an error importing your shapefile:</p>
<pre><code>## Error in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : Open failed.</code></pre>
</div>
<div id="geojson" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> GeoJSON<a class="anchor" aria-label="anchor" href="#geojson"><i class="fas fa-link"></i></a>
</h3>
<p><strong>GeoJSON</strong> is a newer format for encoding a variety of geographical data structures using the <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation (JSON) file format. JSON formatted data is frequently used in web development and services. We will explore it in more detail when we get to <a href="/notes/write-an-api-function/#intro-to-json-and-xml">collecting data from the web.</a> An example of a GeoJSON file is below:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb223-1"><a href="geoviz.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb223-2"><a href="geoviz.html#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"Feature"</span><span class="fu">,</span></span>
<span id="cb223-3"><a href="geoviz.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"geometry"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb223-4"><a href="geoviz.html#cb223-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"Point"</span><span class="fu">,</span></span>
<span id="cb223-5"><a href="geoviz.html#cb223-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"coordinates"</span><span class="fu">:</span> <span class="ot">[</span><span class="fl">125.6</span><span class="ot">,</span> <span class="fl">10.1</span><span class="ot">]</span></span>
<span id="cb223-6"><a href="geoviz.html#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb223-7"><a href="geoviz.html#cb223-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb223-8"><a href="geoviz.html#cb223-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Dinagat Islands"</span></span>
<span id="cb223-9"><a href="geoviz.html#cb223-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb223-10"><a href="geoviz.html#cb223-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>GeoJSON files are plain text files and can contain many different types of geometric features.</p>
</div>
</div>
<div id="simple-features" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Simple features<a class="anchor" aria-label="anchor" href="#simple-features"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://cran.r-project.org/web/views/Spatial.html">There are a crap ton of packages for R that allow you to interact with shapefiles and spatial data.</a> Here we will focus on a modern package for reading and transforming spatial data in a tidy format. <a href="https://en.wikipedia.org/wiki/Simple_Features">Simple features</a> or <a href="http://www.opengeospatial.org/standards/sfa"><strong>simple feature access</strong></a> refers to a formal standard that describes how objects in the real world can be represented in computers, with emphasis on the <strong>spatial</strong> geometry of these objects. It also describes how such objects can be stored in and retrieved from databases, and which geometrical operations should be defined for them.</p>
<p>The standard is widely implemented in spatial databases (such as PostGIS), commercial GIS (e.g., <a href="http://www.esri.com/">ESRI ArcGIS</a>) and forms the vector data basis for libraries such as <a href="http://www.gdal.org/">GDAL</a>. A subset of simple features forms the <a href="http://geojson.org/">GeoJSON</a> standard.</p>
<p>R has well-supported classes for storing spatial data (<a href="https://CRAN.R-project.org/package=sp"><code>sp</code></a>) and interfacing to the above mentioned environments (<a href="https://CRAN.R-project.org/package=rgdal"><code>rgdal</code></a>, <a href="https://CRAN.R-project.org/package=rgeos"><code>rgeos</code></a>), but has so far lacked a complete implementation of simple features, making conversions at times convoluted, inefficient or incomplete. The <a href="http://github.com/r-spatial/sf"><code>sf</code></a> package tries to fill this gap.</p>
<div id="what-is-a-feature" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> What is a feature?<a class="anchor" aria-label="anchor" href="#what-is-a-feature"><i class="fas fa-link"></i></a>
</h3>
<p>A <strong>feature</strong> is a thing or an object in the real world. Often features will consist of a set of features. For instance, a tree can be a feature but a set of trees can form a forest which is itself a feature. Features have <strong>geometry</strong> describing where on Earth the feature is located. They also have attributes, which describe other properties of the feature.</p>
</div>
<div id="dimensions" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Dimensions<a class="anchor" aria-label="anchor" href="#dimensions"><i class="fas fa-link"></i></a>
</h3>
<p>All geometries are composed of points. Points are coordinates in a 2-, 3- or 4-dimensional space. All points in a geometry have the same dimensionality. In addition to X and Y coordinates, there are two optional additional dimensions:</p>
<ul>
<li>a Z coordinate, denoting altitude</li>
<li>an M coordinate (rarely used), denoting some <strong>measure</strong> that is associated with the point, rather than with the feature as a whole (in which case it would be a feature attribute); examples could be time of measurement, or measurement error of the coordinates</li>
</ul>
<p>The four possible cases then are:</p>
<ol style="list-style-type: decimal">
<li>two-dimensional points refer to x and y, easting and northing, or longitude and latitude, we refer to them as XY</li>
<li>three-dimensional points as XYZ</li>
<li>three-dimensional points as XYM</li>
<li>four-dimensional points as XYZM (the third axis is Z, fourth M)</li>
</ol>
</div>
<div id="simple-feature-geometry-types" class="section level3" number="4.6.3">
<h3>
<span class="header-section-number">4.6.3</span> Simple feature geometry types<a class="anchor" aria-label="anchor" href="#simple-feature-geometry-types"><i class="fas fa-link"></i></a>
</h3>
<p>The following seven simple feature types are the most common, and are for instance the only ones used for <a href="https://tools.ietf.org/html/rfc7946">GeoJSON</a>:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="7%">
<col width="92%">
</colgroup>
<thead><tr class="header">
<th>type</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>zero-dimensional geometry containing a single point</td>
</tr>
<tr class="even">
<td><code>LINESTRING</code></td>
<td>sequence of points connected by straight, non-self intersecting line pieces; one-dimensional geometry</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>geometry with a positive area (two-dimensional); sequence of points form a closed, non-self intersecting ring; the first ring denotes the exterior ring, zero or more subsequent rings denote holes in this exterior ring</td>
</tr>
<tr class="even">
<td><code>MULTIPOINT</code></td>
<td>set of points; a MULTIPOINT is simple if no two Points in the MULTIPOINT are equal</td>
</tr>
<tr class="odd">
<td><code>MULTILINESTRING</code></td>
<td>set of linestrings</td>
</tr>
<tr class="even">
<td><code>MULTIPOLYGON</code></td>
<td>set of polygons</td>
</tr>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>set of geometries of any type except GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table></div>
</div>
<div id="coordinate-reference-system" class="section level3" number="4.6.4">
<h3>
<span class="header-section-number">4.6.4</span> Coordinate reference system<a class="anchor" aria-label="anchor" href="#coordinate-reference-system"><i class="fas fa-link"></i></a>
</h3>
<p>Coordinates can only be placed on the Earth’s surface when their coordinate reference system (CRS) is known; this may be an spheroid CRS such as WGS84, a projected, two-dimensional (Cartesian) CRS such as a UTM zone or Web Mercator, or a CRS in three-dimensions, or including time. Similarly, M-coordinates need an attribute reference system, e.g. a <a href="https://CRAN.R-project.org/package=units">measurement unit</a>.</p>
</div>
</div>
<div id="simple-features-in-r" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Simple features in R<a class="anchor" aria-label="anchor" href="#simple-features-in-r"><i class="fas fa-link"></i></a>
</h2>
<p><code>sf</code> stores simple features as basic R data structures (lists, matrix, vectors, etc.). The typical data structure stores geometric and feature attributes as a data frame with one row per feature. However since feature geometries are not single-valued, they are put in a <strong>list-column</strong> with each list element holding the simple feature geometry of that feature.</p>
<div id="importing-spatial-data-using-sf" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> Importing spatial data using <code>sf</code><a class="anchor" aria-label="anchor" href="#importing-spatial-data-using-sf"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code> imports a spatial data file and converts it to a simple feature data frame. Here we import a shapefile containing the spatial boundaries of each <a href="https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6">community area in the city of Chicago</a>.</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chi_shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Boundaries - Community Areas (current)/geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19.shp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Reading layer `geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19' from data source `/Users/soltoffbc/Projects/Data Visualization/course-notes/data/Boundaries - Community Areas (current)/geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19.shp' </span>
<span class="co">##   using driver `ESRI Shapefile'</span>
<span class="co">## Simple feature collection with 77 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42</span>
<span class="co">## Geodetic CRS:  WGS84(DD)</span></code></pre></div>
<p>The short report printed gives the file name, mentions that there are 77 features (records, represented as rows) and 10 fields (attributes, represented as columns), states that the spatial data file is a <code>MULTIPOLYGON</code>, provides the bounding box coordinates, and identifies the projection method (which we will discuss later). If we print the first rows of <code>chi_shape</code>:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chi_shape</span>
<span class="co">## Simple feature collection with 77 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42</span>
<span class="co">## Geodetic CRS:  WGS84(DD)</span>
<span class="co">## First 10 features:</span>
<span class="co">##    perimeter       community shape_len shape_area area comarea area_numbe</span>
<span class="co">## 1          0         DOUGLAS     31027   46004621    0       0         35</span>
<span class="co">## 2          0         OAKLAND     19566   16913961    0       0         36</span>
<span class="co">## 3          0     FULLER PARK     25339   19916705    0       0         37</span>
<span class="co">## 4          0 GRAND BOULEVARD     28197   48492503    0       0         38</span>
<span class="co">## 5          0         KENWOOD     23325   29071742    0       0         39</span>
<span class="co">## 6          0  LINCOLN SQUARE     36625   71352328    0       0          4</span>
<span class="co">## 7          0 WASHINGTON PARK     28175   42373881    0       0         40</span>
<span class="co">## 8          0       HYDE PARK     29747   45105380    0       0         41</span>
<span class="co">## 9          0        WOODLAWN     46937   57815180    0       0         42</span>
<span class="co">## 10         0     ROGERS PARK     34052   51259902    0       0          1</span>
<span class="co">##    area_num_1 comarea_id                       geometry</span>
<span class="co">## 1          35          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 2          36          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 3          37          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 4          38          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 5          39          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 6           4          0 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 7          40          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 8          41          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 9          42          0 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 10          1          0 MULTIPOLYGON (((-87.7 42, -...</span></code></pre></div>
<p>In the output we see:</p>
<ul>
<li>Each row is a simple feature: a single record, or <code>data.frame</code> row, consisting of attributes and geometry</li>
<li>The <code>geometry</code> column is a simple feature list-column (an object of class <code>sfc</code>, which is a column in the <code>data.frame</code>)</li>
<li>Each value in <code>geometry</code> is a single simple feature geometry (an object of class <code>sfg</code>)</li>
</ul>
<p>We start to recognize the data frame structure. Substantively, <code>community</code> defines the name of the community area for each row.</p>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code> also works with GeoJSON files.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chi_json</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Boundaries - Community Areas (current).geojson"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Reading layer `Boundaries - Community Areas (current)' from data source </span>
<span class="co">##   `/Users/soltoffbc/Projects/Data Visualization/course-notes/data/Boundaries - Community Areas (current).geojson' </span>
<span class="co">##   using driver `GeoJSON'</span>
<span class="co">## Simple feature collection with 77 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42</span>
<span class="co">## Geodetic CRS:  WGS 84</span>
<span class="va">chi_json</span>
<span class="co">## Simple feature collection with 77 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42</span>
<span class="co">## Geodetic CRS:  WGS 84</span>
<span class="co">## First 10 features:</span>
<span class="co">##          community area    shape_area perimeter area_num_1 area_numbe</span>
<span class="co">## 1          DOUGLAS    0 46004621.1581         0         35         35</span>
<span class="co">## 2          OAKLAND    0 16913961.0408         0         36         36</span>
<span class="co">## 3      FULLER PARK    0 19916704.8692         0         37         37</span>
<span class="co">## 4  GRAND BOULEVARD    0 48492503.1554         0         38         38</span>
<span class="co">## 5          KENWOOD    0 29071741.9283         0         39         39</span>
<span class="co">## 6   LINCOLN SQUARE    0 71352328.2399         0          4          4</span>
<span class="co">## 7  WASHINGTON PARK    0 42373881.4842         0         40         40</span>
<span class="co">## 8        HYDE PARK    0 45105380.1732         0         41         41</span>
<span class="co">## 9         WOODLAWN    0  57815179.512         0         42         42</span>
<span class="co">## 10     ROGERS PARK    0 51259902.4506         0          1          1</span>
<span class="co">##    comarea_id comarea     shape_len                       geometry</span>
<span class="co">## 1           0       0 31027.0545098 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 2           0       0 19565.5061533 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 3           0       0 25339.0897503 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 4           0       0 28196.8371573 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 5           0       0 23325.1679062 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 6           0       0 36624.6030848 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 7           0       0 28175.3160866 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 8           0       0 29746.7082016 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 9           0       0 46936.9592443 MULTIPOLYGON (((-87.6 41.8,...</span>
<span class="co">## 10          0       0 34052.3975757 MULTIPOLYGON (((-87.7 42, -...</span></code></pre></div>
</div>
</div>
<div id="drawing-vector-maps-with-sf-and-ggplot2" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Drawing vector maps with <code>sf</code> and <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#drawing-vector-maps-with-sf-and-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Unlike <a href="/notes/raster-maps-with-ggmap/">raster image maps</a>, vector maps require you to obtain <a href="/notes/simple-features/">spatial data files</a> which contain detailed information necessary to draw all the components of a map (e.g. points, lines, polygons). Once you successfully import that data into R, <code>ggplot2</code> works with simple features data frames to easily generate geospatial visualizations using all the core elements and approaches of <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<div id="import-usa-state-boundaries" class="section level3" number="4.8.1">
<h3>
<span class="header-section-number">4.8.1</span> Import USA state boundaries<a class="anchor" aria-label="anchor" href="#import-usa-state-boundaries"><i class="fas fa-link"></i></a>
</h3>
<p>First we will import a spatial data file containing the boundaries of all 50 states in the United States<a href="references.html#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> using <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::st_read()</a></code>:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"census_bureau"</span>,
            <span class="st">"cb_2013_us_state_20m"</span>, <span class="st">"cb_2013_us_state_20m.shp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Reading layer `cb_2013_us_state_20m' from data source </span>
<span class="co">##   `/Users/soltoffbc/Projects/Data Visualization/course-notes/data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp' </span>
<span class="co">##   using driver `ESRI Shapefile'</span>
<span class="co">## Simple feature collection with 52 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -179 ymin: 17.9 xmax: 180 ymax: 71.4</span>
<span class="co">## Geodetic CRS:  NAD83</span></code></pre></div>
</div>
<div id="draw-the-boundaries" class="section level3" number="4.8.2">
<h3>
<span class="header-section-number">4.8.2</span> Draw the boundaries<a class="anchor" aria-label="anchor" href="#draw-the-boundaries"><i class="fas fa-link"></i></a>
</h3>
<p><code>ggplot2</code> contains a geometric object specifically for simple feature objects called <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>. This works reasonably well when you need to draw <strong>polygons</strong>, like our state boundaries. Support for simple features in <code>ggplot2</code> is under active development, so you may not find adequate support for plotting line or point features. To draw the map, we pass the simple features data frame as the <code>data</code> argument.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/geom-sf-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Because simple features data frames are standardized with the <code>geometry</code> column always containing information on the geographic coordinates of the features, we do not need to specify additional parameters for <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>. Notice a problem with the map above: it wastes a lot of space. This is caused by the presence of Alaska and Hawaii in the dataset. The Aleutian Islands cross the the 180th meridian, requiring the map to show the Eastern hemisphere. Likewise, Hawaii is substantially distant from the continental United States.</p>
<div id="plot-a-subset-of-a-map" class="section level4" number="4.8.2.1">
<h4>
<span class="header-section-number">4.8.2.1</span> Plot a subset of a map<a class="anchor" aria-label="anchor" href="#plot-a-subset-of-a-map"><i class="fas fa-link"></i></a>
</h4>
<p>One solution is to plot just the lower 48 states. That is, exclude Alaska and Hawaii, as well as DC and Puerto Rico.<a href="references.html#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> Because simple features data frames contain one row per feature and in this example a feature is defined as a state, we can use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> from <code>dplyr</code> to exclude these four states/territories.</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">usa_48</span> <span class="op">&lt;-</span> <span class="va">usa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"District of Columbia"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Simple feature collection with 48 features and 9 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -125 ymin: 24.5 xmax: -66.9 ymax: 49.4</span>
<span class="co">## Geodetic CRS:  NAD83</span>
<span class="co">## First 10 features:</span>
<span class="co">##    STATEFP  STATENS    AFFGEOID GEOID STUSPS        NAME LSAD    ALAND   AWATER</span>
<span class="co">## 1       01 01779775 0400000US01    01     AL     Alabama   00 1.31e+11 4.59e+09</span>
<span class="co">## 2       05 00068085 0400000US05    05     AR    Arkansas   00 1.35e+11 2.96e+09</span>
<span class="co">## 3       06 01779778 0400000US06    06     CA  California   00 4.03e+11 2.05e+10</span>
<span class="co">## 4       09 01779780 0400000US09    09     CT Connecticut   00 1.25e+10 1.82e+09</span>
<span class="co">## 5       12 00294478 0400000US12    12     FL     Florida   00 1.39e+11 3.14e+10</span>
<span class="co">## 6       13 01705317 0400000US13    13     GA     Georgia   00 1.49e+11 4.95e+09</span>
<span class="co">## 7       16 01779783 0400000US16    16     ID       Idaho   00 2.14e+11 2.40e+09</span>
<span class="co">## 8       17 01779784 0400000US17    17     IL    Illinois   00 1.44e+11 6.20e+09</span>
<span class="co">## 9       18 00448508 0400000US18    18     IN     Indiana   00 9.28e+10 1.54e+09</span>
<span class="co">## 10      20 00481813 0400000US20    20     KS      Kansas   00 2.12e+11 1.35e+09</span>
<span class="co">##                          geometry</span>
<span class="co">## 1  MULTIPOLYGON (((-88.3 30.2,...</span>
<span class="co">## 2  MULTIPOLYGON (((-94.6 36.5,...</span>
<span class="co">## 3  MULTIPOLYGON (((-119 33.5, ...</span>
<span class="co">## 4  MULTIPOLYGON (((-73.7 41.1,...</span>
<span class="co">## 5  MULTIPOLYGON (((-80.7 24.9,...</span>
<span class="co">## 6  MULTIPOLYGON (((-85.6 35, -...</span>
<span class="co">## 7  MULTIPOLYGON (((-117 44.4, ...</span>
<span class="co">## 8  MULTIPOLYGON (((-91.5 40.2,...</span>
<span class="co">## 9  MULTIPOLYGON (((-88.1 37.9,...</span>
<span class="co">## 10 MULTIPOLYGON (((-102 40, -1...</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/usa-subset-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Since the map is a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> object, it can easily be modified like any other <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> graph. We could change the color of the map and the borders:</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"palegreen"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/usa-fill-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="albersusa" class="section level4" number="4.8.2.2">
<h4>
<span class="header-section-number">4.8.2.2</span> <code>albersusa</code><a class="anchor" aria-label="anchor" href="#albersusa"><i class="fas fa-link"></i></a>
</h4>
<p>Rather than excluding them entirely, most maps of the United States place Alaska and Hawaii as <strong>insets</strong> to the south of California. Until recently, in R this was an extremely tedious task that required manually changing the latitude and longitude coordinates for these states to place them in the correct location. Fortunately several packages are now available that have already done the work for you. <a href="https://github.com/hrbrmstr/albersusa"><code>albersusa</code></a> includes the <code><a href="https://rdrr.io/pkg/albersusa/man/usa_sf.html">usa_sf()</a></code> function which returns a simple features data frame which contains adjusted coordinates for Alaska and Hawaii to plot them with the mainland. It can be installed from GitHub using <code>devtools::install_github("hrbrmstr/albersusa")</code>.</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hrbrmstr/albersusa">albersusa</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/albersusa/man/usa_sf.html">usa_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Simple feature collection with 51 features and 13 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -125 ymin: 20.6 xmax: -66.9 ymax: 49.4</span>
<span class="co">## Geodetic CRS:  WGS 84</span>
<span class="co">## First 10 features:</span>
<span class="co">##         geo_id fips_state                 name lsad census_area iso_3166_2</span>
<span class="co">## 1  0400000US04         04              Arizona           113594         AZ</span>
<span class="co">## 2  0400000US05         05             Arkansas            52035         AR</span>
<span class="co">## 3  0400000US06         06           California           155779         CA</span>
<span class="co">## 4  0400000US08         08             Colorado           103642         CO</span>
<span class="co">## 5  0400000US09         09          Connecticut             4842         CT</span>
<span class="co">## 6  0400000US11         11 District of Columbia               61         DC</span>
<span class="co">## 7  0400000US13         13              Georgia            57513         GA</span>
<span class="co">## 8  0400000US17         17             Illinois            55519         IL</span>
<span class="co">## 9  0400000US18         18              Indiana            35826         IN</span>
<span class="co">## 10 0400000US22         22            Louisiana            43204         LA</span>
<span class="co">##      census pop_estimataes_base pop_2010 pop_2011 pop_2012 pop_2013 pop_2014</span>
<span class="co">## 1   6392017             6392310  6411999  6472867  6556236  6634997  6731484</span>
<span class="co">## 2   2915918             2915958  2922297  2938430  2949300  2958765  2966369</span>
<span class="co">## 3  37253956            37254503 37336011 37701901 38062780 38431393 38802500</span>
<span class="co">## 4   5029196             5029324  5048575  5119661  5191709  5272086  5355866</span>
<span class="co">## 5   3574097             3574096  3579345  3590537  3594362  3599341  3596677</span>
<span class="co">## 6    601723              601767   605210   620427   635040   649111   658893</span>
<span class="co">## 7   9687653             9688681  9714464  9813201  9919000  9994759 10097343</span>
<span class="co">## 8  12830632            12831587 12840097 12858725 12873763 12890552 12880580</span>
<span class="co">## 9   6483802             6484192  6490308  6516560  6537632  6570713  6596855</span>
<span class="co">## 10  4533372             4533479  4545581  4575972  4604744  4629284  4649676</span>
<span class="co">##                          geometry</span>
<span class="co">## 1  MULTIPOLYGON (((-113 37, -1...</span>
<span class="co">## 2  MULTIPOLYGON (((-94 33, -94...</span>
<span class="co">## 3  MULTIPOLYGON (((-120 34, -1...</span>
<span class="co">## 4  MULTIPOLYGON (((-107 41, -1...</span>
<span class="co">## 5  MULTIPOLYGON (((-72.4 42, -...</span>
<span class="co">## 6  MULTIPOLYGON (((-77 38.8, -...</span>
<span class="co">## 7  MULTIPOLYGON (((-84.8 35, -...</span>
<span class="co">## 8  MULTIPOLYGON (((-89.4 42.5,...</span>
<span class="co">## 9  MULTIPOLYGON (((-84.8 40.4,...</span>
<span class="co">## 10 MULTIPOLYGON (((-88.9 29.8,...</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/albersusa/man/usa_sf.html">usa_sf</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/albersusa-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="add-data-to-the-map" class="section level3" number="4.8.3">
<h3>
<span class="header-section-number">4.8.3</span> Add data to the map<a class="anchor" aria-label="anchor" href="#add-data-to-the-map"><i class="fas fa-link"></i></a>
</h3>
<p>Region boundaries serve as the background in geospatial data visualization - so now we need to add data. Some types of geographic data (points and symbols) are overlaid on top of the boundaries, whereas other data (fill) are incorporated into the region layer itself.</p>
<div id="points-1" class="section level4" number="4.8.3.1">
<h4>
<span class="header-section-number">4.8.3.1</span> Points<a class="anchor" aria-label="anchor" href="#points-1"><i class="fas fa-link"></i></a>
</h4>
<p>Let’s use our <code>usa_48</code> map data to add some points. The <code>airports</code> data frame in the <code>nycflights13</code> package includes geographic info on airports in the United States.</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span>
<span class="va">airports</span>
<span class="co">## # A tibble: 1,458 × 8</span>
<span class="co">##    faa   name                             lat    lon   alt    tz dst   tzone    </span>
<span class="co">##    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    </span>
<span class="co">##  1 04G   Lansdowne Airport               41.1  -80.6  1044    -5 A     America/…</span>
<span class="co">##  2 06A   Moton Field Municipal Airport   32.5  -85.7   264    -6 A     America/…</span>
<span class="co">##  3 06C   Schaumburg Regional             42.0  -88.1   801    -6 A     America/…</span>
<span class="co">##  4 06N   Randall Airport                 41.4  -74.4   523    -5 A     America/…</span>
<span class="co">##  5 09J   Jekyll Island Airport           31.1  -81.4    11    -5 A     America/…</span>
<span class="co">##  6 0A9   Elizabethton Municipal Airport  36.4  -82.2  1593    -5 A     America/…</span>
<span class="co">##  7 0G6   Williams County Airport         41.5  -84.5   730    -5 A     America/…</span>
<span class="co">##  8 0G7   Finger Lakes Regional Airport   42.9  -76.8   492    -5 A     America/…</span>
<span class="co">##  9 0P2   Shoestring Aviation Airfield    39.8  -76.6  1000    -5 U     America/…</span>
<span class="co">## 10 0S9   Jefferson County Intl           48.1 -123.    108    -8 A     America/…</span>
<span class="co">## # … with 1,448 more rows</span></code></pre></div>
<p>Each airport has it’s geographic location encoded through <code>lat</code> and <code>lon</code>. To draw these points on the map, basically we draw a scatterplot with <code>x = lon</code> and <code>y = lat</code>. In fact we could simply do that:</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/scatter-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Let’s overlay it with the mapped state borders:</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airports</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/flights-usa-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Slight problem. We have airports listed outside of the continental United States. There are a couple ways to rectify this. Unfortunately <code>airports</code> does not include a variable identifying state so the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> operation is not that simple. The easiest solution is to crop the limits of the graph using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> to only show the mainland:</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airports</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span>,
           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/crop-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Alternatively, we can use <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf()</a></code> to convert <code>airports</code> to a simple features data frame.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airports_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">airports</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">airports_sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4326</span>   <span class="co"># set the coordinate reference system</span>
<span class="va">airports_sf</span>
<span class="co">## Simple feature collection with 1458 features and 6 fields</span>
<span class="co">## Geometry type: POINT</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -177 ymin: 19.7 xmax: 174 ymax: 72.3</span>
<span class="co">## Geodetic CRS:  WGS 84</span>
<span class="co">## # A tibble: 1,458 × 7</span>
<span class="co">##    faa   name                    alt    tz dst   tzone     geometry</span>
<span class="co">##  * &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;POINT [°]&gt;</span>
<span class="co">##  1 04G   Lansdowne Airport      1044    -5 A     Amer… (-80.6 41.1)</span>
<span class="co">##  2 06A   Moton Field Municipa…   264    -6 A     Amer… (-85.7 32.5)</span>
<span class="co">##  3 06C   Schaumburg Regional     801    -6 A     Amer…   (-88.1 42)</span>
<span class="co">##  4 06N   Randall Airport         523    -5 A     Amer… (-74.4 41.4)</span>
<span class="co">##  5 09J   Jekyll Island Airport    11    -5 A     Amer… (-81.4 31.1)</span>
<span class="co">##  6 0A9   Elizabethton Municip…  1593    -5 A     Amer… (-82.2 36.4)</span>
<span class="co">##  7 0G6   Williams County Airp…   730    -5 A     Amer… (-84.5 41.5)</span>
<span class="co">##  8 0G7   Finger Lakes Regiona…   492    -5 A     Amer… (-76.8 42.9)</span>
<span class="co">##  9 0P2   Shoestring Aviation …  1000    -5 U     Amer… (-76.6 39.8)</span>
<span class="co">## 10 0S9   Jefferson County Intl   108    -8 A     Amer…  (-123 48.1)</span>
<span class="co">## # … with 1,448 more rows</span></code></pre></div>
<p><code>coords</code> tells <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf()</a></code> which columns contain the geographic coordinates of each airport. To graph the points on the map, we use a second <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>:</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airports_sf</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span>,
           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/flights-sf-plot-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="symbols-1" class="section level4" number="4.8.3.2">
<h4>
<span class="header-section-number">4.8.3.2</span> Symbols<a class="anchor" aria-label="anchor" href="#symbols-1"><i class="fas fa-link"></i></a>
</h4>
<p>We can change the size or type of symbols on the map. For instance, we can draw a <strong>bubble plot</strong> (also known as a <strong>proportional symbol map</strong>) and encode the altitude of the airport through the size channel:</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airports</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, size <span class="op">=</span> <span class="va">alt</span><span class="op">)</span>,
             fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span>,
           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_area</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/airport-alt-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Circle area is proportional to the airport’s altitude (in feet). Or we could scale it based on the number of arriving flights in <code>flights</code>:</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airports_n</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airports_n</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,
             fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span>,
           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_area</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/airport-dest-1.png" width="80%" style="display: block; margin: auto;"></div>

<div class="rmdnote">
<p><code>airports</code> contains a list of virtually all commercial airports in the United States. However <code>flights</code> only contains data on flights departing from New York City airports (JFK, LaGuardia, or Newark) and only services a few airports around the country.</p>
</div>
</div>
<div id="fill-choropleths" class="section level4" number="4.8.3.3">
<h4>
<span class="header-section-number">4.8.3.3</span> Fill (choropleths)<a class="anchor" aria-label="anchor" href="#fill-choropleths"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Choropleth maps</strong> encode information by assigning shades of colors to defined areas on a map (e.g. countries, states, counties, zip codes). There are lots of ways to tweak and customize these graphs, which is generally a good idea because remember that color is one of the harder-to-decode channels.</p>
<p>We will continue to use the <code>usa_48</code> simple features data frame and draw a choropleth for the number of foreign-born individuals in each state. We get those files from the <code>census_bureau</code> folder. Let’s also normalize our measure by the total population to get the rate of foreign-born individuals in the population:</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">fb_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"census_bureau"</span>,
                  <span class="st">"ACS_13_5YR_B05012_state"</span>, <span class="st">"ACS_13_5YR_B05012.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">HD01_VD03</span> <span class="op">/</span> <span class="va">HD01_VD01</span><span class="op">)</span><span class="op">)</span>
<span class="co">## # A tibble: 51 × 10</span>
<span class="co">##    GEO.id      GEO.id2 `GEO.display-la…` HD01_VD01 HD02_VD01 HD01_VD02 HD02_VD02</span>
<span class="co">##    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;                 &lt;dbl&gt; &lt;lgl&gt;         &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">##  1 0400000US01 01      Alabama             4799277 NA          4631045      2881</span>
<span class="co">##  2 0400000US02 02      Alaska               720316 NA           669941      1262</span>
<span class="co">##  3 0400000US04 04      Arizona             6479703 NA          5609835      7725</span>
<span class="co">##  4 0400000US05 05      Arkansas            2933369 NA          2799972      2568</span>
<span class="co">##  5 0400000US06 06      California         37659181 NA         27483342     30666</span>
<span class="co">##  6 0400000US08 08      Colorado            5119329 NA          4623809      5778</span>
<span class="co">##  7 0400000US09 09      Connecticut         3583561 NA          3096374      5553</span>
<span class="co">##  8 0400000US10 10      Delaware             908446 NA           831683      2039</span>
<span class="co">##  9 0400000US11 11      District of Colu…    619371 NA           534142      2017</span>
<span class="co">## 10 0400000US12 12      Florida            19091156 NA         15392410     16848</span>
<span class="co">## # … with 41 more rows, and 3 more variables: HD01_VD03 &lt;dbl&gt;, HD02_VD03 &lt;dbl&gt;,</span>
<span class="co">## #   rate &lt;dbl&gt;</span></code></pre></div>
<div id="join-the-data" class="section level5" number="4.8.3.3.1">
<h5>
<span class="header-section-number">4.8.3.3.1</span> Join the data<a class="anchor" aria-label="anchor" href="#join-the-data"><i class="fas fa-link"></i></a>
</h5>
<p>Now that we have our data, we want to draw it on the map. <code>fb_state</code> contains one row per state, as does <code>usa_48</code>. Since there is a one-to-one match between the data frames, we join the data frames together first, then use that single data frame to draw the map. This differs from the approach above for drawing points because a point feature is not the same thing as a polygon feature. That is, there were more airports then there were states. Because the spatial data is stored in a data frame with one row per state, all we need to do is merge the data frames together on a column that uniquely identifies each row in each data frame.</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">usa_fb</span> <span class="op">&lt;-</span> <span class="va">usa_48</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">fb_state</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"STATEFP"</span> <span class="op">=</span> <span class="st">"GEO.id2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Simple feature collection with 48 features and 18 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -125 ymin: 24.5 xmax: -66.9 ymax: 49.4</span>
<span class="co">## Geodetic CRS:  NAD83</span>
<span class="co">## First 10 features:</span>
<span class="co">##    STATEFP  STATENS    AFFGEOID GEOID STUSPS        NAME LSAD    ALAND   AWATER</span>
<span class="co">## 1       01 01779775 0400000US01    01     AL     Alabama   00 1.31e+11 4.59e+09</span>
<span class="co">## 2       05 00068085 0400000US05    05     AR    Arkansas   00 1.35e+11 2.96e+09</span>
<span class="co">## 3       06 01779778 0400000US06    06     CA  California   00 4.03e+11 2.05e+10</span>
<span class="co">## 4       09 01779780 0400000US09    09     CT Connecticut   00 1.25e+10 1.82e+09</span>
<span class="co">## 5       12 00294478 0400000US12    12     FL     Florida   00 1.39e+11 3.14e+10</span>
<span class="co">## 6       13 01705317 0400000US13    13     GA     Georgia   00 1.49e+11 4.95e+09</span>
<span class="co">## 7       16 01779783 0400000US16    16     ID       Idaho   00 2.14e+11 2.40e+09</span>
<span class="co">## 8       17 01779784 0400000US17    17     IL    Illinois   00 1.44e+11 6.20e+09</span>
<span class="co">## 9       18 00448508 0400000US18    18     IN     Indiana   00 9.28e+10 1.54e+09</span>
<span class="co">## 10      20 00481813 0400000US20    20     KS      Kansas   00 2.12e+11 1.35e+09</span>
<span class="co">##         GEO.id GEO.display-label HD01_VD01 HD02_VD01 HD01_VD02 HD02_VD02</span>
<span class="co">## 1  0400000US01           Alabama   4799277        NA   4631045      2881</span>
<span class="co">## 2  0400000US05          Arkansas   2933369        NA   2799972      2568</span>
<span class="co">## 3  0400000US06        California  37659181        NA  27483342     30666</span>
<span class="co">## 4  0400000US09       Connecticut   3583561        NA   3096374      5553</span>
<span class="co">## 5  0400000US12           Florida  19091156        NA  15392410     16848</span>
<span class="co">## 6  0400000US13           Georgia   9810417        NA   8859747      7988</span>
<span class="co">## 7  0400000US16             Idaho   1583364        NA   1489560      2528</span>
<span class="co">## 8  0400000US17          Illinois  12848554        NA  11073828     10091</span>
<span class="co">## 9  0400000US18           Indiana   6514861        NA   6206801      4499</span>
<span class="co">## 10 0400000US20            Kansas   2868107        NA   2677007      3095</span>
<span class="co">##    HD01_VD03 HD02_VD03   rate                       geometry</span>
<span class="co">## 1     168232      2881 0.0351 MULTIPOLYGON (((-88.3 30.2,...</span>
<span class="co">## 2     133397      2568 0.0455 MULTIPOLYGON (((-94.6 36.5,...</span>
<span class="co">## 3   10175839     30666 0.2702 MULTIPOLYGON (((-119 33.5, ...</span>
<span class="co">## 4     487187      5553 0.1360 MULTIPOLYGON (((-73.7 41.1,...</span>
<span class="co">## 5    3698746     16848 0.1937 MULTIPOLYGON (((-80.7 24.9,...</span>
<span class="co">## 6     950670      7988 0.0969 MULTIPOLYGON (((-85.6 35, -...</span>
<span class="co">## 7      93804      2528 0.0592 MULTIPOLYGON (((-117 44.4, ...</span>
<span class="co">## 8    1774726     10093 0.1381 MULTIPOLYGON (((-91.5 40.2,...</span>
<span class="co">## 9     308060      4500 0.0473 MULTIPOLYGON (((-88.1 37.9,...</span>
<span class="co">## 10    191100      3100 0.0666 MULTIPOLYGON (((-102 40, -1...</span></code></pre></div>
</div>
<div id="draw-the-map" class="section level5" number="4.8.3.3.2">
<h5>
<span class="header-section-number">4.8.3.3.2</span> Draw the map<a class="anchor" aria-label="anchor" href="#draw-the-map"><i class="fas fa-link"></i></a>
</h5>
<p>With the newly combined data frame, use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> and define the <code>fill</code> aesthetic based on the column in <code>usa_fb</code> you want to visualize.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_fb</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/geom-map-state-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="bin-data-to-discrete-intervals" class="section level4" number="4.8.3.4">
<h4>
<span class="header-section-number">4.8.3.4</span> Bin data to discrete intervals<a class="anchor" aria-label="anchor" href="#bin-data-to-discrete-intervals"><i class="fas fa-link"></i></a>
</h4>
<p>When creating a heatmap with a continuous variable, one must decide whether to keep the variable as continuous or collapse it into a series of bins with discrete colors. While keep the variable continuous is technically more precise, <a href="https://www.perceptualedge.com/articles/visual_business_intelligence/heatmaps_to_bin_or_not.pdf">the human eye cannot usually distinguish between two colors which are very similar to one another.</a> By converting the variable to a discrete variable, you easily distinguish between the different levels. If you decide to convert a continuous variable to a discrete variable, you will need to decide how to do this. While <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> is a base R function for converting continuous variables into discrete values, <code>ggplot2</code> offers two functions that explicitly define how we want to bin the numeric vector (column).</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code> makes <code>n</code> groups with equal range:</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_fb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval</a></span><span class="op">(</span><span class="va">rate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rate_cut</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-interval-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Whereas <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code> makes <code>n</code> groups with (approximately) equal numbers of observations:</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_fb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rate_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number</a></span><span class="op">(</span><span class="va">rate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rate_cut</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-number-1.png" width="80%" style="display: block; margin: auto;"></div>

<div class="rmdnote">
<p>See <a href="https://gis.stackexchange.com/questions/86668/should-i-use-a-discrete-or-continuous-scale-for-coloring-a-chloropleth">this StackOverflow thread</a> for a more in-depth discussion on the merits of bucketizing a continuous variable and whether to use <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code>.</p>
</div>
</div>
</div>
<div id="changing-map-projection" class="section level3" number="4.8.4">
<h3>
<span class="header-section-number">4.8.4</span> Changing map projection<a class="anchor" aria-label="anchor" href="#changing-map-projection"><i class="fas fa-link"></i></a>
</h3>
<iframe src="https://www.youtube.com/embed/vVX-PrBRtTY" width="80%" height="400px" data-external="1">
</iframe>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:xkcd-mercator"></span>
<img src="https://imgs.xkcd.com/comics/mercator_projection.png" alt="[Mercator Projection](https://xkcd.com/2082/)" width="80%"><p class="caption">
Figure 4.2: <a href="https://xkcd.com/2082/">Mercator Projection</a>
</p>
</div>
<p>Representing portions of the globe on a flat surface can be challenging. Depending on how you project the map, you can distort or emphasize certain features of the map. Fortunately, <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> includes the <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> function which allows us to easily implement different projection methods. In order to implement coordinate transformations, you need to know the <strong>coordinate reference system</strong> that defines the projection method. The “easiest” approach is to provide what is known as the <code>proj4string</code> that defines the projection method. <a href="https://proj4.org/">PROJ4</a> is a generic coordinate transformation software that allows you to convert between projection methods. If you get really into geospatial analysis and visualization, it is helpful to learn this system.</p>
<p>For our purposes here, <code>proj4string</code> is a character string in R that defines the coordinate system and includes parameters specific to a given coordinate transformation. PROJ4 includes <a href="https://proj4.org/operations/projections/index.html">some documentation on common projection methods</a> that can get you started. Some projection methods are relatively simple and require just the name of the projection, like for a <a href="https://proj4.org/operations/projections/merc.html">Mercator projection</a> (<code>"+proj=merc"</code>):</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_proj_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_48</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_proj_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=merc"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mercator projection"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/mercator-proj-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Other coordinate systems require specification of the <strong>standard lines</strong>, or lines that define areas of the surface of the map that are tangent to the globe. These include <a href="http://spatialreference.org/ref/sr-org/gall-peters-orthographic-projection/proj4/">Gall-Peters</a>, <a href="https://proj4.org/operations/projections/aea.html">Albers equal-area</a>, and <a href="https://proj4.org/operations/projections/laea.html">Lambert azimuthal</a>.</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_proj_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=cea +lon_0=0 +lat_ts=45"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Gall-Peters projection"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/projection-rest-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">map_proj_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=aea +lat_1=25 +lat_2=50 +lon_0=-100"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Albers equal-area projection"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/projection-rest-2.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">map_proj_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=laea +lat_0=35 +lon_0=-100"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Lambert azimuthal projection"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/projection-rest-3.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="practice-drawing-vector-maps" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Practice drawing vector maps<a class="anchor" aria-label="anchor" href="#practice-drawing-vector-maps"><i class="fas fa-link"></i></a>
</h2>
<div id="american-community-survey" class="section level3" number="4.9.1">
<h3>
<span class="header-section-number">4.9.1</span> American Community Survey<a class="anchor" aria-label="anchor" href="#american-community-survey"><i class="fas fa-link"></i></a>
</h3>
<p>The U.S. Census Bureau conducts the <a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a> which gathers detailed information on topics such as demographics, employment, educational attainment, etc. They make a vast portion of their data available through an <a href="/notes/application-program-interface/">application programming interface (API)</a>, which can be accessed intuitively through R via the <a href="https://walkerke.github.io/tidycensus/index.html"><code>tidycensus</code> package</a>. We previously discussed how to use this package to <a href="/notes/application-program-interface/#census-data-with-tidycensus">obtain statistical data from the decennial census</a>. However the Census Bureau also has detailed information on political and geographic boundaries which we can combine with their statistical measures to easily construct geospatial visualizations.</p>

<div class="rmdalert">
<p>If you have not already, <a href="https://api.census.gov/data/key_signup.html">obtain an API key</a> and <a href="/notes/application-program-interface/#census-data-with-tidycensus">store it securely</a> on your computer.</p>
</div>
</div>
<div id="exercise-visualize-income-data" class="section level3" number="4.9.2">
<h3>
<span class="header-section-number">4.9.2</span> Exercise: Visualize income data<a class="anchor" aria-label="anchor" href="#exercise-visualize-income-data"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Obtain information on median household income in 2017 for Cook County, IL at the tract-level using the ACS. To retrieve the geographic features for each tract, set <code>geometry = TRUE</code> in your function.</p>
<blockquote>
<p>You can use <code>load_variables(year = 2017, dataset = "acs5")</code> to retrieve the list of variables available and search to find the correct variable name.</p>
</blockquote>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"IL"</span>,
                    county <span class="op">=</span> <span class="st">"Cook"</span>,
                    geography <span class="op">=</span> <span class="st">"tract"</span>, 
                    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>medincome <span class="op">=</span> <span class="st">"B19013_001"</span><span class="op">)</span>, 
                    year <span class="op">=</span> <span class="fl">2017</span>,
                    geometry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span>
<span class="co">## Simple feature collection with 1319 features and 5 fields (with 1 geometry empty)</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -88.3 ymin: 41.5 xmax: -87.5 ymax: 42.2</span>
<span class="co">## Geodetic CRS:  NAD83</span>
<span class="co">## First 10 features:</span>
<span class="co">##          GEOID                                       NAME  variable estimate</span>
<span class="co">## 1  17031010201 Census Tract 102.01, Cook County, Illinois medincome    40841</span>
<span class="co">## 2  17031030200    Census Tract 302, Cook County, Illinois medincome    64089</span>
<span class="co">## 3  17031031700    Census Tract 317, Cook County, Illinois medincome    44555</span>
<span class="co">## 4  17031031900    Census Tract 319, Cook County, Illinois medincome    61211</span>
<span class="co">## 5  17031050200    Census Tract 502, Cook County, Illinois medincome    74375</span>
<span class="co">## 6  17031051300    Census Tract 513, Cook County, Illinois medincome   149271</span>
<span class="co">## 7  17031061500    Census Tract 615, Cook County, Illinois medincome   117656</span>
<span class="co">## 8  17031062600    Census Tract 626, Cook County, Illinois medincome   144211</span>
<span class="co">## 9  17031063400    Census Tract 634, Cook County, Illinois medincome    95488</span>
<span class="co">## 10 17031070600    Census Tract 706, Cook County, Illinois medincome   151250</span>
<span class="co">##      moe                       geometry</span>
<span class="co">## 1   7069 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 2  12931 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 3  12220 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 4   6343 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 5  18773 MULTIPOLYGON (((-87.7 42, -...</span>
<span class="co">## 6  26389 MULTIPOLYGON (((-87.7 41.9,...</span>
<span class="co">## 7  11416 MULTIPOLYGON (((-87.7 41.9,...</span>
<span class="co">## 8  22537 MULTIPOLYGON (((-87.7 41.9,...</span>
<span class="co">## 9   4904 MULTIPOLYGON (((-87.6 41.9,...</span>
<span class="co">## 10 47800 MULTIPOLYGON (((-87.7 41.9,...</span></code></pre></div>

</details>
</li>
<li>
<p>Draw a choropleth using the median household income data. Use a continuous color gradient to identify each tract’s median household income.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cook_inc</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_color_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_fill_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/income-cook-map-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
</ol>
</div>
<div id="exercise-customize-your-maps" class="section level3" number="4.9.3">
<h3>
<span class="header-section-number">4.9.3</span> Exercise: Customize your maps<a class="anchor" aria-label="anchor" href="#exercise-customize-your-maps"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Draw the same choropleth for Cook County, but convert median household income into a discrete variable with 6 levels.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<ul>
<li>
<p>Using <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code>:</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inc_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval</a></span><span class="op">(</span><span class="va">estimate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">inc_cut</span>, color <span class="op">=</span> <span class="va">inc_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-interval-cook-1.png" width="80%" style="display: block; margin: auto;"></div>
</li>
<li>
<p>Using <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code>:</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inc_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number</a></span><span class="op">(</span><span class="va">estimate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">inc_cut</span>, color <span class="op">=</span> <span class="va">inc_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-number-cook-1.png" width="80%" style="display: block; margin: auto;"></div>

</li>
</ul></details>
</li>

<li>
<p>Draw the same choropleth for Cook County using the discrete variable, but select an appropriate color palette using <a href="/notes/optimal-color-palettes/#color-brewer">Color Brewer</a>.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<ul>
<li>
<p>Using <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code> and the Blue-Green palette:</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inc_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval</a></span><span class="op">(</span><span class="va">estimate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">inc_cut</span>, color <span class="op">=</span> <span class="va">inc_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"seq"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"seq"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-interval-optimal-1.png" width="80%" style="display: block; margin: auto;"></div>
</li>
<li>
<p>Using <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code> and the Blue-Green palette:</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cook_inc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inc_cut <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number</a></span><span class="op">(</span><span class="va">estimate</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">inc_cut</span>, color <span class="op">=</span> <span class="va">inc_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"seq"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"seq"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span> <span class="op">+</span>
 <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cut-number-optimal-1.png" width="80%" style="display: block; margin: auto;"></div>
</li>
</ul>
<p>You can choose any palette that is for sequential data.</p>

</details>
</li>
<li>
<p>Use the <a href="/notes/optimal-color-palettes/#viridis"><code>viridis</code> color palette</a> for the Cook County map drawn using the continuous measure.</p>
<details><summary><p>Click for the solution</p>
</summary><p>
</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cook_inc</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># use fill and color to avoid gray boundary lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># increase interpretability of graph</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_color_viridis</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income in Cook County, IL"</span>,
       subtitle <span class="op">=</span> <span class="st">"In 2017"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Source: American Community Survey"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/income-cook-map-viridis-1.png" width="80%" style="display: block; margin: auto;"></div>

</details>
</li>
</ol>
</div>
</div>
<div id="selecting-optimal-color-palettes" class="section level2" number="4.10">
<h2>
<span class="header-section-number">4.10</span> Selecting optimal color palettes<a class="anchor" aria-label="anchor" href="#selecting-optimal-color-palettes"><i class="fas fa-link"></i></a>
</h2>
<p>Selection of your <strong>color palette</strong> is perhaps the most important decision to make when drawing a choropleth. By default, <code>ggplot2</code> picks evenly spaced hues around the <a href="https://en.wikipedia.org/wiki/HCL_color_space">Hue-Chroma-Luminance (HCL) color space</a>:<a href="references.html#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a></p>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/color-wheel-1.png" width="80%" style="display: block; margin: auto;"></div>
<p><code>ggplot2</code> gives you many different ways of defining and customizing your <code>scale_color_</code> and <code>scale_fill_</code> palettes, but will not tell you if they are optimal for your specific usage in the graph.</p>
<div id="color-brewer" class="section level3" number="4.10.1">
<h3>
<span class="header-section-number">4.10.1</span> Color Brewer<a class="anchor" aria-label="anchor" href="#color-brewer"><i class="fas fa-link"></i></a>
</h3>
<p><a href="http://colorbrewer2.org/">Color Brewer</a> is a diagnostic tool for selecting optimal color palettes for maps with discrete variables. The authors have generated different color palettes designed to make differentiating between categories easy depending on the scaling of your variable. All you need to do is define the number of categories in the variable, the nature of your data (sequential, diverging, or qualitative), and a color scheme. There are also options to select palettes that are colorblind safe, print friendly, and photocopy safe. Depending on the combination of options, you may not find any color palette that matches your criteria. In such a case, consider reducing the number of data classes.</p>
<div id="sequential" class="section level4" number="4.10.1.1">
<h4>
<span class="header-section-number">4.10.1.1</span> Sequential<a class="anchor" aria-label="anchor" href="#sequential"><i class="fas fa-link"></i></a>
</h4>
<p>Sequential palettes work best with ordered data that progresses from a low to high value.</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"seq"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cb-seq-1.png" width="80%" style="display: block; margin: auto;"></div>
<p><img src="04-making-maps_files/figure-html/cb-seq-map-1.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-seq-map-2.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-seq-map-3.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div id="diverging" class="section level4" number="4.10.1.2">
<h4>
<span class="header-section-number">4.10.1.2</span> Diverging<a class="anchor" aria-label="anchor" href="#diverging"><i class="fas fa-link"></i></a>
</h4>
<p>Diverging palettes work for variables with meaningful mid-range values, as well as extreme low and high values.</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"div"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cb-div-1.png" width="80%" style="display: block; margin: auto;"></div>
<p><img src="04-making-maps_files/figure-html/cb-div-map-1.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-div-map-2.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-div-map-3.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div id="qualitative" class="section level4" number="4.10.1.3">
<h4>
<span class="header-section-number">4.10.1.3</span> Qualitative<a class="anchor" aria-label="anchor" href="#qualitative"><i class="fas fa-link"></i></a>
</h4>
<p>Qualitative palettes are best used for nominal data where there is no inherent ordering to the categories.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/cb-qual-1.png" width="80%" style="display: block; margin: auto;"></div>
<p><img src="04-making-maps_files/figure-html/cb-qual-map-1.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-qual-map-2.png" width="80%" style="display: block; margin: auto;"><img src="04-making-maps_files/figure-html/cb-qual-map-3.png" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="viridis" class="section level3" number="4.10.2">
<h3>
<span class="header-section-number">4.10.2</span> Viridis<a class="anchor" aria-label="anchor" href="#viridis"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://cran.r-project.org/web/packages/viridis/"><code>viridis</code></a> package imports several color palettes for continuous variables from the <code>matplotlib</code> package in Python. These palettes have been tested to be colorful, perceptually uniform, robust to colorblindness, and pretty. To use these with <code>ggplot2</code>, use <code><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_color_viridis()</a></code> and <code><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis()</a></code>:</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>

<span class="va">viridis_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">state_inc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Median household income, 2016"</span>,
       subtitle <span class="op">=</span> <span class="st">"Palette: viridis"</span>,
       caption <span class="op">=</span> <span class="st">"Source: 2016 American Community Survey"</span>,
       fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span>

<span class="va">viridis_base</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/viridis-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viridis_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"cividis"</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Palette: cividis"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/viridis-2.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viridis_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Palette: inferno"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/viridis-3.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viridis_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Palette: magma"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/viridis-4.png" width="80%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">viridis_base</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Palette: plasma"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-making-maps_files/figure-html/viridis-5.png" width="80%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="session-info-3" class="section level2 unnumbered">
<h2>Session info<a class="anchor" aria-label="anchor" href="#session-info-3"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## ─ Session info ───────────────────────────────────────────────────────────────</span>
<span class="co">##  setting  value</span>
<span class="co">##  version  R version 4.1.2 (2021-11-01)</span>
<span class="co">##  os       macOS Monterey 12.2.1</span>
<span class="co">##  system   aarch64, darwin20</span>
<span class="co">##  ui       X11</span>
<span class="co">##  language (EN)</span>
<span class="co">##  collate  en_US.UTF-8</span>
<span class="co">##  ctype    en_US.UTF-8</span>
<span class="co">##  tz       America/Chicago</span>
<span class="co">##  date     2022-03-04</span>
<span class="co">##  pandoc   2.17.1.1 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/ (via rmarkdown)</span>
<span class="co">## </span>
<span class="co">## ─ Packages ───────────────────────────────────────────────────────────────────</span>
<span class="co">##  package       * version    date (UTC) lib source</span>
<span class="co">##  albersusa     * 0.4.1      2022-01-06 [1] Github (hrbrmstr/albersusa@07aa87f)</span>
<span class="co">##  assertthat      0.2.1      2019-03-21 [1] CRAN (R 4.1.0)</span>
<span class="co">##  backports       1.4.1      2021-12-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  bit             4.0.4      2020-08-04 [1] CRAN (R 4.1.1)</span>
<span class="co">##  bit64           4.0.5      2020-08-30 [1] CRAN (R 4.1.0)</span>
<span class="co">##  bitops          1.0-7      2021-04-24 [1] CRAN (R 4.1.0)</span>
<span class="co">##  bookdown        0.24       2021-09-02 [1] CRAN (R 4.1.1)</span>
<span class="co">##  brio            1.1.3      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  broom           0.7.12     2022-01-28 [1] CRAN (R 4.1.1)</span>
<span class="co">##  bslib           0.3.1      2021-10-06 [1] CRAN (R 4.1.1)</span>
<span class="co">##  cachem          1.0.6      2021-08-19 [1] CRAN (R 4.1.1)</span>
<span class="co">##  callr           3.7.0      2021-04-20 [1] CRAN (R 4.1.0)</span>
<span class="co">##  cellranger      1.1.0      2016-07-27 [1] CRAN (R 4.1.0)</span>
<span class="co">##  class           7.3-20     2022-01-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  classInt        0.4-3      2020-04-07 [1] CRAN (R 4.1.0)</span>
<span class="co">##  cli             3.2.0      2022-02-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  codetools       0.2-18     2020-11-04 [1] CRAN (R 4.1.2)</span>
<span class="co">##  colorspace      2.0-3      2022-02-21 [1] CRAN (R 4.1.1)</span>
<span class="co">##  crayon          1.5.0      2022-02-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  curl            4.3.2      2021-06-23 [1] CRAN (R 4.1.0)</span>
<span class="co">##  DBI             1.1.2      2021-12-20 [1] CRAN (R 4.1.1)</span>
<span class="co">##  dbplyr          2.1.1      2021-04-06 [1] CRAN (R 4.1.0)</span>
<span class="co">##  desc            1.4.0      2021-09-28 [1] CRAN (R 4.1.1)</span>
<span class="co">##  devtools        2.4.3      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  digest          0.6.29     2021-12-01 [1] CRAN (R 4.1.1)</span>
<span class="co">##  dplyr         * 1.0.8      2022-02-08 [1] CRAN (R 4.1.1)</span>
<span class="co">##  e1071           1.7-9      2021-09-16 [1] CRAN (R 4.1.1)</span>
<span class="co">##  ellipsis        0.3.2      2021-04-29 [1] CRAN (R 4.1.0)</span>
<span class="co">##  evaluate        0.15       2022-02-18 [1] CRAN (R 4.1.1)</span>
<span class="co">##  fansi           1.0.2      2022-01-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  farver          2.1.0      2021-02-28 [1] CRAN (R 4.1.0)</span>
<span class="co">##  fastmap         1.1.0      2021-01-25 [1] CRAN (R 4.1.0)</span>
<span class="co">##  forcats       * 0.5.1      2021-01-27 [1] CRAN (R 4.1.1)</span>
<span class="co">##  foreign         0.8-82     2022-01-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  fs              1.5.2      2021-12-08 [1] CRAN (R 4.1.1)</span>
<span class="co">##  generics        0.1.2      2022-01-31 [1] CRAN (R 4.1.1)</span>
<span class="co">##  ggmap         * 3.0.0      2019-02-05 [1] CRAN (R 4.1.1)</span>
<span class="co">##  ggplot2       * 3.3.5      2021-06-25 [1] CRAN (R 4.1.1)</span>
<span class="co">##  glue            1.6.1      2022-01-22 [1] CRAN (R 4.1.1)</span>
<span class="co">##  gridExtra       2.3        2017-09-09 [1] CRAN (R 4.1.1)</span>
<span class="co">##  gtable          0.3.0      2019-03-25 [1] CRAN (R 4.1.1)</span>
<span class="co">##  haven           2.4.3      2021-08-04 [1] CRAN (R 4.1.1)</span>
<span class="co">##  here          * 1.0.1      2020-12-13 [1] CRAN (R 4.1.0)</span>
<span class="co">##  highr           0.9        2021-04-16 [1] CRAN (R 4.1.0)</span>
<span class="co">##  hms             1.1.1      2021-09-26 [1] CRAN (R 4.1.1)</span>
<span class="co">##  htmltools       0.5.2      2021-08-25 [1] CRAN (R 4.1.1)</span>
<span class="co">##  httr            1.4.2      2020-07-20 [1] CRAN (R 4.1.0)</span>
<span class="co">##  isoband         0.2.5      2021-07-13 [1] CRAN (R 4.1.0)</span>
<span class="co">##  jpeg            0.1-9      2021-07-24 [1] CRAN (R 4.1.0)</span>
<span class="co">##  jquerylib       0.1.4      2021-04-26 [1] CRAN (R 4.1.0)</span>
<span class="co">##  jsonlite        1.8.0      2022-02-22 [1] CRAN (R 4.1.1)</span>
<span class="co">##  KernSmooth      2.23-20    2021-05-03 [1] CRAN (R 4.1.2)</span>
<span class="co">##  kimisc          0.4        2017-12-18 [1] CRAN (R 4.1.0)</span>
<span class="co">##  knitr           1.37       2021-12-16 [1] CRAN (R 4.1.1)</span>
<span class="co">##  labeling        0.4.2      2020-10-20 [1] CRAN (R 4.1.0)</span>
<span class="co">##  lattice         0.20-45    2021-09-22 [1] CRAN (R 4.1.2)</span>
<span class="co">##  lifecycle       1.0.1      2021-09-24 [1] CRAN (R 4.1.1)</span>
<span class="co">##  lubridate       1.8.0      2021-10-07 [1] CRAN (R 4.1.1)</span>
<span class="co">##  magrittr        2.0.2      2022-01-26 [1] CRAN (R 4.1.1)</span>
<span class="co">##  maptools        1.1-2      2021-09-07 [1] CRAN (R 4.1.1)</span>
<span class="co">##  MASS            7.3-55     2022-01-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  memoise         2.0.1      2021-11-26 [1] CRAN (R 4.1.1)</span>
<span class="co">##  modelr          0.1.8      2020-05-19 [1] CRAN (R 4.1.0)</span>
<span class="co">##  munsell         0.5.0      2018-06-12 [1] CRAN (R 4.1.0)</span>
<span class="co">##  nycflights13  * 1.0.2      2021-04-12 [1] CRAN (R 4.1.0)</span>
<span class="co">##  patchwork     * 1.1.1      2020-12-17 [1] CRAN (R 4.1.1)</span>
<span class="co">##  pillar          1.7.0      2022-02-01 [1] CRAN (R 4.1.1)</span>
<span class="co">##  pkgbuild        1.3.1      2021-12-20 [1] CRAN (R 4.1.1)</span>
<span class="co">##  pkgconfig       2.0.3      2019-09-22 [1] CRAN (R 4.1.0)</span>
<span class="co">##  pkgload         1.2.4      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  plyr            1.8.6      2020-03-03 [1] CRAN (R 4.1.0)</span>
<span class="co">##  png             0.1-7      2013-12-03 [1] CRAN (R 4.1.0)</span>
<span class="co">##  prettyunits     1.1.1      2020-01-24 [1] CRAN (R 4.1.0)</span>
<span class="co">##  processx        3.5.2      2021-04-30 [1] CRAN (R 4.1.0)</span>
<span class="co">##  proxy           0.4-26     2021-06-07 [1] CRAN (R 4.1.0)</span>
<span class="co">##  ps              1.6.0      2021-02-28 [1] CRAN (R 4.1.0)</span>
<span class="co">##  purrr         * 0.3.4      2020-04-17 [1] CRAN (R 4.1.0)</span>
<span class="co">##  R6              2.5.1      2021-08-19 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rappdirs        0.3.3      2021-01-31 [1] CRAN (R 4.1.0)</span>
<span class="co">##  RColorBrewer  * 1.1-2      2014-12-07 [1] CRAN (R 4.1.0)</span>
<span class="co">##  Rcpp            1.0.8      2022-01-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  readr         * 2.1.2      2022-01-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  readxl          1.3.1      2019-03-13 [1] CRAN (R 4.1.0)</span>
<span class="co">##  remotes         2.4.2      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  reprex          2.0.1      2021-08-05 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rgdal           1.5-28     2021-12-15 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rgeos           0.5-9      2021-12-15 [1] CRAN (R 4.1.1)</span>
<span class="co">##  RgoogleMaps     1.4.5.3    2020-02-12 [1] CRAN (R 4.1.0)</span>
<span class="co">##  rjson           0.2.21     2022-01-09 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rlang           1.0.1      2022-02-03 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rmarkdown       2.11       2021-09-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  rnaturalearth * 0.1.0      2017-03-21 [1] CRAN (R 4.1.0)</span>
<span class="co">##  rprojroot       2.0.2      2020-11-15 [1] CRAN (R 4.1.0)</span>
<span class="co">##  rstudioapi      0.13       2020-11-12 [1] CRAN (R 4.1.0)</span>
<span class="co">##  rvest           1.0.2      2021-10-16 [1] CRAN (R 4.1.1)</span>
<span class="co">##  s2              1.0.7      2021-09-28 [1] CRAN (R 4.1.1)</span>
<span class="co">##  sass            0.4.0      2021-05-12 [1] CRAN (R 4.1.0)</span>
<span class="co">##  scales          1.1.1      2020-05-11 [1] CRAN (R 4.1.0)</span>
<span class="co">##  sessioninfo     1.2.2      2021-12-06 [1] CRAN (R 4.1.1)</span>
<span class="co">##  sf            * 1.0-6      2022-02-04 [1] CRAN (R 4.1.1)</span>
<span class="co">##  sp              1.4-6      2021-11-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  stringi         1.7.6      2021-11-29 [1] CRAN (R 4.1.1)</span>
<span class="co">##  stringr       * 1.4.0      2019-02-10 [1] CRAN (R 4.1.1)</span>
<span class="co">##  testthat        3.1.2      2022-01-20 [1] CRAN (R 4.1.1)</span>
<span class="co">##  tibble        * 3.1.6      2021-11-07 [1] CRAN (R 4.1.1)</span>
<span class="co">##  tidycensus    * 1.1.0.9000 2022-01-25 [1] Github (walkerke/tidycensus@8b8e38a)</span>
<span class="co">##  tidyr         * 1.2.0      2022-02-01 [1] CRAN (R 4.1.1)</span>
<span class="co">##  tidyselect      1.1.2      2022-02-21 [1] CRAN (R 4.1.1)</span>
<span class="co">##  tidyverse     * 1.3.1      2021-04-15 [1] CRAN (R 4.1.0)</span>
<span class="co">##  tigris          1.6        2022-02-22 [1] CRAN (R 4.1.1)</span>
<span class="co">##  tzdb            0.2.0      2021-10-27 [1] CRAN (R 4.1.1)</span>
<span class="co">##  units           0.8-0      2022-02-05 [1] CRAN (R 4.1.1)</span>
<span class="co">##  usethis         2.1.5      2021-12-09 [1] CRAN (R 4.1.1)</span>
<span class="co">##  utf8            1.2.2      2021-07-24 [1] CRAN (R 4.1.0)</span>
<span class="co">##  uuid            1.0-3      2021-11-01 [1] CRAN (R 4.1.1)</span>
<span class="co">##  vctrs           0.3.8      2021-04-29 [1] CRAN (R 4.1.0)</span>
<span class="co">##  viridis       * 0.6.2      2021-10-13 [1] CRAN (R 4.1.1)</span>
<span class="co">##  viridisLite   * 0.4.0      2021-04-13 [1] CRAN (R 4.1.0)</span>
<span class="co">##  vroom           1.5.7      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  withr           2.4.3      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  wk              0.6.0      2022-01-03 [1] CRAN (R 4.1.2)</span>
<span class="co">##  xfun            0.29       2021-12-14 [1] CRAN (R 4.1.1)</span>
<span class="co">##  xml2            1.3.3      2021-11-30 [1] CRAN (R 4.1.1)</span>
<span class="co">##  yaml            2.3.5      2022-02-21 [1] CRAN (R 4.1.1)</span>
<span class="co">## </span>
<span class="co">##  [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library</span>
<span class="co">## </span>
<span class="co">## ──────────────────────────────────────────────────────────────────────────────</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="science-polish.html"><span class="header-section-number">3</span> Making plots pretty and clean</a></div>
<div class="next"><a href="shiny.html"><span class="header-section-number">5</span> Shiny applications</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#geoviz"><span class="header-section-number">4</span> Geospatial visualizations</a></li>
<li>
<a class="nav-link" href="#learning-objectives-4">Learning objectives</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#morning-3"><span class="header-section-number">4.0.1</span> Morning</a></li>
<li><a class="nav-link" href="#afternoon-3"><span class="header-section-number">4.0.2</span> Afternoon</a></li>
</ul>
</li>
<li><a class="nav-link" href="#assigned-readings-3">Assigned readings</a></li>
<li>
<a class="nav-link" href="#introduction-to-geospatial-visualization"><span class="header-section-number">4.1</span> Introduction to geospatial visualization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#john-snow-and-the-broad-street-water-pump"><span class="header-section-number">4.1.1</span> John Snow and the Broad Street water pump</a></li>
<li><a class="nav-link" href="#carte-figurative-des-pertes-successives-en-hommes-de-larm%C3%A9e-fran%C3%A7aise-dans-la-campagne-de-russie-1812-1813"><span class="header-section-number">4.1.2</span> Carte figurative des pertes successives en hommes de l’Armée Française dans la campagne de Russie 1812-1813)</a></li>
<li><a class="nav-link" href="#designing-modern-maps"><span class="header-section-number">4.1.3</span> Designing modern maps</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#drawing-raster-maps-with-ggmap"><span class="header-section-number">4.2</span> Drawing raster maps with ggmap</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#obtain-map-images"><span class="header-section-number">4.2.1</span> Obtain map images</a></li>
<li><a class="nav-link" href="#specifying-map-regions"><span class="header-section-number">4.2.2</span> Specifying map regions</a></li>
<li><a class="nav-link" href="#types-of-map-tiles"><span class="header-section-number">4.2.3</span> Types of map tiles</a></li>
<li><a class="nav-link" href="#import-crime-data"><span class="header-section-number">4.2.4</span> Import crime data</a></li>
<li><a class="nav-link" href="#plot-high-level-map-of-crime"><span class="header-section-number">4.2.5</span> Plot high-level map of crime</a></li>
<li><a class="nav-link" href="#using-geom_point"><span class="header-section-number">4.2.6</span> Using geom_point()</a></li>
<li><a class="nav-link" href="#using-stat_density_2d"><span class="header-section-number">4.2.7</span> Using stat_density_2d()</a></li>
<li><a class="nav-link" href="#looking-for-variation"><span class="header-section-number">4.2.8</span> Looking for variation</a></li>
<li><a class="nav-link" href="#locations-of-murders"><span class="header-section-number">4.2.9</span> Locations of murders</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exercise-chicago-311-data"><span class="header-section-number">4.3</span> Exercise: Chicago 311 data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#visualize-the-311-data"><span class="header-section-number">4.3.1</span> Visualize the 311 data</a></li></ul>
</li>
<li><a class="nav-link" href="#importing-spatial-data-files-using-sf"><span class="header-section-number">4.4</span> Importing spatial data files using sf</a></li>
<li>
<a class="nav-link" href="#file-formats"><span class="header-section-number">4.5</span> File formats</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#shapefile"><span class="header-section-number">4.5.1</span> Shapefile</a></li>
<li><a class="nav-link" href="#geojson"><span class="header-section-number">4.5.2</span> GeoJSON</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#simple-features"><span class="header-section-number">4.6</span> Simple features</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-a-feature"><span class="header-section-number">4.6.1</span> What is a feature?</a></li>
<li><a class="nav-link" href="#dimensions"><span class="header-section-number">4.6.2</span> Dimensions</a></li>
<li><a class="nav-link" href="#simple-feature-geometry-types"><span class="header-section-number">4.6.3</span> Simple feature geometry types</a></li>
<li><a class="nav-link" href="#coordinate-reference-system"><span class="header-section-number">4.6.4</span> Coordinate reference system</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#simple-features-in-r"><span class="header-section-number">4.7</span> Simple features in R</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#importing-spatial-data-using-sf"><span class="header-section-number">4.7.1</span> Importing spatial data using sf</a></li></ul>
</li>
<li>
<a class="nav-link" href="#drawing-vector-maps-with-sf-and-ggplot2"><span class="header-section-number">4.8</span> Drawing vector maps with sf and ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#import-usa-state-boundaries"><span class="header-section-number">4.8.1</span> Import USA state boundaries</a></li>
<li><a class="nav-link" href="#draw-the-boundaries"><span class="header-section-number">4.8.2</span> Draw the boundaries</a></li>
<li><a class="nav-link" href="#add-data-to-the-map"><span class="header-section-number">4.8.3</span> Add data to the map</a></li>
<li><a class="nav-link" href="#changing-map-projection"><span class="header-section-number">4.8.4</span> Changing map projection</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#practice-drawing-vector-maps"><span class="header-section-number">4.9</span> Practice drawing vector maps</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#american-community-survey"><span class="header-section-number">4.9.1</span> American Community Survey</a></li>
<li><a class="nav-link" href="#exercise-visualize-income-data"><span class="header-section-number">4.9.2</span> Exercise: Visualize income data</a></li>
<li><a class="nav-link" href="#exercise-customize-your-maps"><span class="header-section-number">4.9.3</span> Exercise: Customize your maps</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#selecting-optimal-color-palettes"><span class="header-section-number">4.10</span> Selecting optimal color palettes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#color-brewer"><span class="header-section-number">4.10.1</span> Color Brewer</a></li>
<li><a class="nav-link" href="#viridis"><span class="header-section-number">4.10.2</span> Viridis</a></li>
</ul>
</li>
<li><a class="nav-link" href="#session-info-3">Session info</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Visualization</strong>: MACS 20700/40700" was written by Benjamin Soltoff. It was last built on 2022-03-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
