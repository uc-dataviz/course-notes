---
title: "Making plots pretty and clean"
author: "MACS 24000 <br /> University of Chicago"
output: rcfss::xaringan
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(cache = TRUE, message = FALSE, warning = FALSE, echo = FALSE,
                      fig.retina = 2, fig.width = 12, fig.align = "center")

set.seed(1234)
```

```{r packages, include = FALSE, cache = FALSE}
library(tidyverse)
library(ggthemes)
library(knitr)
library(broom)
library(stringr)
library(socviz)
library(patchwork)
library(RColorBrewer)
library(colorspace)
library(dichromat)
library(ggrepel)
library(ggthemes)
library(scales)
library(gapminder)
library(here)
library(flipbookr)

theme_set(theme_minimal(base_size = rcfss::base_size))
default_width <- c(50, 50, 0)
```

<div style="width:100%;height:0;padding-bottom:56%;position:relative;"><iframe src="https://giphy.com/embed/Av1omfvEeKi3drblRr" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe></div>

---

# Tufte's world

* Core purpose of visualization is to communicate quantitative information
    * Art is secondary
    * "Above all else show the data"
    
--

## Data-ink ratio

$$\text{Data-ink ratio} = \frac{\text{data-ink}}{\text{total ink used to print the graphic}}$$

* Maximize this ratio, minimize all extraneous fluff
* What should we consider to be part of the "data-ink"?
* He never offers proof of his hypothesis that **less is better**

---

# What is integral?

```{r integral}
p <- ggplot(data = organdata, aes(x = roads, y = donors)) +
  geom_point() +
  theme_grey()
p
```

---

# Strip away the non-essential

```{r integral-void, dependson = "integral"}
p + theme_void(base_size = rcfss::base_size)
```

---

# Strip away the non-essential

```{r integral-background, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size)
```

---

# Strip away the non-essential

```{r integral-panelbox, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size) +
  theme(
    panel.background = element_blank(),
    panel.border = element_blank()
  )
```

---

# Strip away the non-essential

```{r integral-minor, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size) +
  theme(
    panel.background = element_blank(),
    panel.border = element_blank(),
    strip.background = element_blank(),
    plot.background = element_blank(),
    axis.line = element_blank(),
    panel.grid.minor = element_blank()
  )
```

---

# Strip away the non-essential

```{r integral-major, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size) +
  theme(
    panel.background = element_blank(),
    panel.border = element_blank(),
    strip.background = element_blank(),
    plot.background = element_blank(),
    axis.line = element_blank(),
    panel.grid = element_blank()
  )
```

---

# Strip away the non-essential

```{r integral-tick, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size) +
  theme(
    panel.background = element_blank(),
    panel.border = element_blank(),
    strip.background = element_blank(),
    plot.background = element_blank(),
    axis.line = element_blank(),
    panel.grid = element_blank(),
    axis.ticks = element_blank()
  )
```

---

# Strip away the non-essential

```{r integral-serif, dependson = "integral"}
p + theme_bw(base_size = rcfss::base_size, base_family = "serif") +
  theme(
    panel.background = element_blank(),
    panel.border = element_blank(),
    strip.background = element_blank(),
    plot.background = element_blank(),
    axis.line = element_blank(),
    panel.grid = element_blank(),
    axis.ticks = element_blank()
  )
```

---

# Chart junk

```{r chart-junk-1, out.width = "90%"}
knitr::include_graphics(here("images", "monster-costs.png"))
```

---

# Chart junk

```{r chart-junk-2}
knitr::include_graphics(here("images", "mcdonalds.jpeg"))
```

---

# Chart junk

```{r chart-junk-3, out.width = "40%"}
knitr::include_graphics(here("images", "3d-ribbon-chart.jpeg"))
```

---

# Chart junk

```{r chart-junk-4, out.width = "120%"}
knitr::include_graphics(here("images", "wasted-space.jpeg"))
```

---

# Chart junk

Tufte concludes that forgoing chartjunk enables functionality and insight (as Cairo would describe it). **Do you agree?**

---

# Creating Tufte-style graphs

The goal of Tufte's minimalism is to maximize the data-ink ratio, so we want to modify traditional or default graphs in R and `ggplot2` to minimize use of extraneous ink.

---

# Minimal line plot

```{r cache = FALSE}
knitr::opts_chunk$set(fig.width = 7)

```

.pull-left[

```{r line}
x <- 1967:1977
y <- c(0.5, 1.8, 4.6, 5.3, 5.3, 5.7, 5.4, 5, 5.5, 6, 5)
d <- tibble(x, y)

ggplot(d, aes(x, y)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = round(seq(min(x), max(x), length.out = 4))) +
  scale_y_continuous(breaks = seq(1, 6, 1), labels = sprintf("$%s", seq(300, 400, 20))) +
  labs(
    title = "Per capita budget expandures",
    x = "Year",
    y = "Per capita budget expandures\nin constant dollars"
  )
```

]

--

.pull-right[

```{r minline}
ggplot(d, aes(x, y)) +
  geom_line() +
  geom_point(size = 3) +
  theme_tufte(base_size = rcfss::base_size) +
  theme(axis.title = element_blank()) +
  geom_hline(yintercept = c(5, 6), lty = 2) +
  scale_y_continuous(breaks = seq(1, 6, 1), label = sprintf("$%s", seq(300, 400, 20))) +
  scale_x_continuous(breaks = x, label = x) +
  annotate(
    "text",
    x = c(1977, 1977.2),
    y = c(1.5, 5.5),
    adj = 1,
    size = 8,
    family = "serif",
    label = c("Per capita\nbudget expandures\nin constant dollars", "5%")
  )
```

]

---

# Minimal boxplot

.pull-left[

```{r boxplot}
ggplot(quakes, aes(factor(mag), stations)) +
  geom_boxplot() +
  labs(
    title = "Fiji earthquakes",
    x = "Richter Magnitude",
    y = "Number of stations reporting earthquakes"
  )
```

]

--

.pull-right[

```{r minboxplot}
ggplot(quakes, aes(factor(mag), stations)) +
  theme_tufte(base_size = rcfss::base_size) +
  geom_tufteboxplot(outlier.colour = "transparent") +
  theme(axis.title = element_blank()) +
  annotate(
    "text",
    x = 8,
    y = 120,
    adj = 1,
    family = "serif",
    size = 6,
    label = c(
      "Number of stations \nreporting Richter Magnitude\nof Fiji earthquakes (n=1000)"
    )
  )
```

]

---

# Minimal boxplot

.pull-left[

```{r boxplot-again, ref.label = "boxplot"}
```

]

.pull-right[

```{r offset-boxplot}
ggplot(quakes, aes(factor(mag), stations)) +
  theme_tufte(base_size = rcfss::base_size) +
  geom_tufteboxplot(median.type = "line") +
  theme(axis.title = element_blank()) +
  annotate(
    "text",
    x = 8,
    y = 120,
    adj = 1,
    family = "serif",
    size = 6,
    label = c(
      "Number of stations \nreporting Richter Magnitude\nof Fiji earthquakes (n=1000)"
    )
  )
```

]

---

# Minimal barchart

.pull-left[

```{r bar}
gss_relig <- gss_sm %>%
  count(religion) %>%
  mutate(n_pct = n / sum(n)) %>%
  drop_na()

p <- ggplot(data = gss_relig, mapping = aes(x = fct_reorder(religion, -n_pct), y = n_pct)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Religious affiliation in the United States, 2016",
    x = NULL,
    y = "Percentage of respondents"
  )
p
```

]

--

.pull-right[

```{r minbar}
ggplot(data = gss_relig, mapping = aes(x = fct_reorder(religion, -n_pct), y = n_pct)) +
  geom_col(width = 0.25, fill = "gray") +
  theme_tufte(base_size = rcfss::base_size, ticks = F) +
  theme(axis.title = element_blank()) +
  scale_y_continuous(breaks = seq(0, .5, .1), labels = scales::percent) +
  geom_hline(
    yintercept = seq(0, .5, .1),
    col = "white",
    lwd = 1
  ) +
  annotate(
    "text",
    x = 5.5,
    y = .47,
    adj = 1,
    family = "serif",
    size = 8,
    label = c(
      glue::glue("Religious affiliations in the U.S.\n(Source: 2016 GSS)")
    )
  )
```

]

---

# Range-frame scatterplot

.pull-left[

```{r scatterplot}
ggplot(data = drop_na(organdata, roads, donors), aes(x = roads, y = donors)) +
  geom_point() +
  labs(
    x = "Road accident fatalities per 100,000 population",
    y = "Organ donation rate per million population"
  )
```

]

--

.pull-right[

```{r range-frame}
ggplot(data = drop_na(organdata, roads, donors), aes(x = roads, y = donors)) +
  geom_point() +
  geom_rangeframe() +
  theme_tufte(base_size = rcfss::base_size) +
  labs(
    x = "Road accident fatalities per 100,000 population",
    y = "Organ donation rate per million population"
  ) +
  theme(
    axis.title.x = element_text(vjust = -0.5),
    axis.title.y = element_text(vjust = 1.5)
  )
```

]

---

# Quartile plot

.pull-left[

```{r scatterplot-again, ref.label = "scatterplot"}
ggplot(data = drop_na(organdata, roads, donors), aes(x = roads, y = donors)) +
  geom_point() +
  labs(
    x = "Road accident fatalities per 100,000 population",
    y = "Organ donation rate per million population"
  )
```

]

.pull-right[

```{r range-frame-quartile}
library(devtools)
source_url("https://raw.githubusercontent.com/bearloga/Quartile-frame-Scatterplot/master/qfplot.R")

qfplot(
  x = drop_na(organdata, roads, donors)$roads,
  y = drop_na(organdata, roads, donors)$donors,
  xlab = "Road accident fatalities per 100,000 population",
  ylab = "Organ donation rate per million population"
)
```

]


---

# Reconsidering Tufte

---

# When is redundancy better?

```{r double-bar-chart, out.width = "80%"}
knitr::include_graphics("https://dougmccune.com/blog/wp-content/uploads/2011/04/burglary1.png")
```
    
---

# When is redundancy better?

```{r double-bar-chart-facet}
knitr::include_graphics("https://dougmccune.com/blog/wp-content/uploads/2011/04/small_multiples_small.png")
```

---

# Does minimalism really help?

```{r naep-junk, out.width = "80%"}
knitr::include_graphics("https://junkcharts.typepad.com/.a/6a00d8341e992c53ef01b7c8b60cd9970b-pi")
```

---

# Redesigned version

```{r naep-redesign}
knitr::include_graphics("https://junkcharts.typepad.com/.a/6a00d8341e992c53ef01b8d23fe1c7970c-pi")
```

---

# Experimental tests of Tufte's claims

```{r tufte-experiment}
knitr::include_graphics(here("images", "tufte_experiment.png"))
```

---

# Results

```{r tufte-experiment-results}
knitr::include_graphics(here("images", "tufte_experiment_results.png"))
```

---

# Rethinking Tufte

* Too many of Tufte's claims are based on nothing
* Yet this design philosophy carries significant cache
* Don't assume - test your visualizations

---

# Midday break

```{r take-a-break, echo = FALSE}
knitr::include_graphics("https://i0.wp.com/redgalmusings.com/wp-content/uploads/2018/10/take-a-break-hamilton.gif")
```
